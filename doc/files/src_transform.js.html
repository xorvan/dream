<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>src\transform.js - DreamJs</title>
    <link rel="stylesheet" href="http:&#x2F;&#x2F;yui.yahooapis.com&#x2F;3.8.0&#x2F;build&#x2F;cssgrids&#x2F;cssgrids-min.css">
    <link rel="stylesheet" href="..&#x2F;assets/vendor/prettify/prettify-min.css">
    <link rel="stylesheet" href="..&#x2F;assets/css/main.css" id="site_styles">
    <link rel="shortcut icon" type="image/png" href="..&#x2F;assets/favicon.png">
    <script src="http:&#x2F;&#x2F;yui.yahooapis.com&#x2F;combo?3.8.0&#x2F;build&#x2F;yui&#x2F;yui-min.js"></script>
</head>
<body class="yui3-skin-sam">

<div id="doc">
    <div id="hd" class="yui3-g header">
        <div class="yui3-u-3-4">
            
                <h1><img src="..&#x2F;assets/css/logo.png" title="DreamJs"></h1>
            
        </div>
        <div class="yui3-u-1-4 version">
            <em>API Docs for: 0.0.8</em>
        </div>
    </div>
    <div id="bd" class="yui3-g">

        <div class="yui3-u-1-4">
            <div id="docs-sidebar" class="sidebar apidocs">
                <div id="api-list">
    <h2 class="off-left">APIs</h2>
    <div id="api-tabview" class="tabview">
        <ul class="tabs">
            <li><a href="#api-classes">Classes</a></li>
            <li><a href="#api-modules">Modules</a></li>
        </ul>

        <div id="api-tabview-filter">
            <input type="search" id="api-filter" placeholder="Type to filter APIs">
        </div>

        <div id="api-tabview-panel">
            <ul id="api-classes" class="apis classes">
            
                <li><a href="..&#x2F;classes/dream.dynamic.Action.html">dream.dynamic.Action</a></li>
            
                <li><a href="..&#x2F;classes/dream.dynamic.Animation.html">dream.dynamic.Animation</a></li>
            
                <li><a href="..&#x2F;classes/dream.dynamic.Dynamic.html">dream.dynamic.Dynamic</a></li>
            
                <li><a href="..&#x2F;classes/dream.dynamic.Tween.html">dream.dynamic.Tween</a></li>
            
            </ul>

            <ul id="api-modules" class="apis modules">
            
                <li><a href="..&#x2F;modules/dynamic.html">dynamic</a></li>
            
            </ul>
        </div>
    </div>
</div>

            </div>
        </div>
        <div class="yui3-u-3-4">
                <div id="api-options">
        Show:
        <label for="api-show-inherited">
            <input type="checkbox" id="api-show-inherited" checked>
            Inherited
        </label>

        <label for="api-show-protected">
            <input type="checkbox" id="api-show-protected">
            Protected
        </label>

        <label for="api-show-private">
            <input type="checkbox" id="api-show-private">
            Private
        </label>
        <label for="api-show-deprecated">
            <input type="checkbox" id="api-show-deprecated">
            Deprecated
        </label>

    </div>


            <div class="apidocs">
                <div id="docs-main">
                    <div class="content">
                        <h1 class="file-heading">File: src\transform.js</h1>

<div class="file">
    <pre class="code prettyprint linenums">
&#x2F;**
 * 
 *&#x2F;
(function(){

&#x2F;**
 * 
 *&#x2F;
var Matrix = function(x0, y0, x1, y1, dx, dy){
	this.x0 = x0;
	if(!x0 &amp;&amp; x0 !== 0) this.x0 = 1;
	this.y0 = y0 || 0;
	this.x1 = x1 || 0;
	this.y1 = y1;
	if(!y1 &amp;&amp; y1 !== 0) this.y1 = 1;
	this.dx = dx || 0;
	this.dy = dy || 0;
};
var $ = Matrix.prototype;

$.multiplyBy = function(matrix){
	return new dream.transform.Matrix(
			this.x0 * matrix.x0 + this.y0 * matrix.x1, this.x0 * matrix.y0 + this.y0 * matrix.y1, 
			this.x1 * matrix.x0 + this.y1 * matrix.x1, this.x1 * matrix.y0 + this.y1 * matrix.y1, 
			this.x0 * matrix.dx + this.x1 * matrix.dy + this.dx,
			this.y0 * matrix.dx + this.y1 * matrix.dy + this.dy
	);
};

$.multiplyByPoint = function(point){
	return new dream.Point(
			this.x0 * point.left + this.x1 * point.top + this.dx,
			this.y0 * point.left + this.y1 * point.top + this.dy
	);
};

Object.defineProperty($, &quot;inverse&quot;, {
	get : function () {
		var x0 = this.x0;
		var y0 = this.y0;
		var x1 = this.x1;
		var y1 = this.y1;
		var dx = this.dx;
		var dy = this.dy;
		var n = x0*y1-y0*x1;

		return new Matrix(y1&#x2F;n, -y0&#x2F;n, -x1&#x2F;n, x0&#x2F;n, (x1*dy-y1*dx)&#x2F;n, -(x0*dy-y0*dx)&#x2F;n);
	}
});

&#x2F;**
 * 
 *&#x2F;
var Transformation = function(){
	this.isChanged = true;
};
var $ = Transformation.prototype;

dream.event.create($, &quot;onChange&quot;);
dream.event.create($, &quot;onPositionChange&quot;);

Object.defineProperty($, &quot;matrix&quot;, {
	get : function () {
		if(this.isChanged){
			this.updateMatrix();
			this.isChanged = false;
		}
		return this._matrix;
	}
});

Object.defineProperty($, &quot;inverse&quot;, {
	get : function () {
		var m = this.matrix.inverse;
		return new Custom(m.x0, m.y0, m.x1, m.y1, m.dx, m.dy);
	}
});

$.hasTransform = false;

$.compose = function(transformation){
	var m = this.matrix.multiplyBy(transformation.matrix);
	return new Custom(m.x0, m.y0, m.x1, m.y1, m.dx, m.dy);
};

$.project = function(point){
	return this.matrix.multiplyByPoint(point);
};

$.projectRect = function(rect){
	return new dream.Rect(rect.left, rect.top, rect.width, rect.height, this.compose(rect.transformation));
};

$.unproject = function(point){
	return this.matrix.inverse.multiplyByPoint(point);
};

$.unprojectRect = function(rect){
	return new dream.Rect(rect.left, rect.top, rect.width, rect.height, this.inverse.compose(rect.transformation));
};

$.apply = function(context, origin){
	return origin;
};

&#x2F;**
 * 
 *&#x2F;
var Identity = function(left, top){
	this._matrix = new Matrix();
}.inherits(Transformation);
var $ = Identity.prototype;

Object.defineProperty($, &quot;matrix&quot;, {
	get : function () {
		return this._matrix;
	}
});

&#x2F;**
 * 
 *&#x2F;
var Translation = function(left, top){
	Translation._superClass.call(this);
	this._left = left || 0;
	this._top = top || 0;
}.inherits(Transformation);
var $ = Translation.prototype;

dream.util.createEventFlagProperty($, &quot;left&quot;, &quot;onPositionChange&quot;);
dream.util.createEventFlagProperty($, &quot;top&quot;, &quot;onPositionChange&quot;);

Object.defineProperty($, &quot;hasTransform&quot;, {
	get : function () {
		return this._left || this._top;
	}
});

$.updateMatrix = function(){
	this._matrix = new dream.transform.Matrix(1, 0, 0, 1, this._left, this._top);
};

$.apply = function(context, origin){
	return new dream.Point(origin.left + this._left|0, origin.top + this._top|0);
};

&#x2F;**
 * 
 *&#x2F;
var Rotation = function(angle){
	Rotation._superClass.call(this);
	this._angle = angle * dream.transform.DEG_TO_RAD || 0;
}.inherits(Transformation);
var $ = Rotation.prototype;

Object.defineProperty($, &quot;angle&quot;, {
	get: function () {
		return this._angle * dream.transform.RAD_TO_DEG;
	},
	set: function(v){
		this._angle = this.hasTransform = (v%360) * dream.transform.DEG_TO_RAD;
		this.isChanged = true;
		dream.event.dispatch(this, &quot;onChange&quot;);
	} 
});

$.updateMatrix = function(){
	var a = this._angle,
		c = Math.cos(a),
		s = Math.sin(a);
	this._matrix = new dream.transform.Matrix(c, s, -s, c, 0, 0);
};

$.apply = function(context, origin){
	var ol = origin.left, ot = origin.top; 
	if(ol || ot){
		context.translate(ol, ot);
	}
	context.rotate(this._angle);
	return new dream.Point;
};

&#x2F;**
 * 
 *&#x2F;
var Scale = function(x, y){
	Scale._superClass.call(this);
	this._x = x;
	this._y = y;
	
	if(this._x == undefined) this._x = 1;
	if(this._y == undefined) this._y = 1;
}.inherits(Transformation);
var $ = Scale.prototype;

dream.util.createEventFlagProperty($, &quot;x&quot;);
dream.util.createEventFlagProperty($, &quot;y&quot;);

Object.defineProperty($, &quot;hasTransform&quot;, {
	get : function () {
		return this._x != 1 || this._y != 1;
	}
});

$.updateMatrix = function(){
	this._matrix = new dream.transform.Matrix(this._x, 0, 0, this._y, 0, 0);
};

$.apply = function(context, origin){
	var ol = origin.left, ot = origin.top; 
	if(ol || ot){
		context.translate(ol, ot);
	}
	context.scale(this._x, this._y);
	return new dream.Point;
};

&#x2F;**
 * 
 *&#x2F;
var Custom = function(x0, y0, x1, y1, dx, dy){
	Custom._superClass.call(this);
	this._x0 = x0;
	if(!x0 &amp;&amp; x0 !== 0) this._x0 = 1;
	this._y0 = y0 || 0;
	this._x1 = x1 || 0;
	this._y1 = y1;
	if(!y1 &amp;&amp; y1 !== 0) this._y1 = 1;
	this._dx = dx || 0;
	this._dy = dy || 0;	
}.inherits(Transformation);
var $ = Custom.prototype;

dream.util.createEventFlagProperty($, &quot;x0&quot;);
dream.util.createEventFlagProperty($, &quot;y0&quot;);
dream.util.createEventFlagProperty($, &quot;x1&quot;);
dream.util.createEventFlagProperty($, &quot;y1&quot;);
dream.util.createEventFlagProperty($, &quot;dx&quot;);
dream.util.createEventFlagProperty($, &quot;dy&quot;);

Object.defineProperty($, &quot;hasTransform&quot;, {
	get : function () {
		return this._x0 != 1 || this._y0 || this._x1 || this._y1 != 1 || this._dx || this._dy;
	}
});


$.updateMatrix = function(){
	this._matrix = new Matrix(this._x0, this._y0, this._x1, this._y1, this._dx, this._dy);
};

$.apply = function(context, origin){
	var ol = origin.left, ot = origin.top; 
	if(ol || ot){
		context.translate(ol, ot);
	}
	context.transform(this._x0, this._y0, this._x1, this._y1, this._dx, this._dy);
	return new dream.Point;
};


&#x2F;**
 * 
 *&#x2F;
var Composite = function(transformations){
	Composite._superClass.call(this);
	var composite = this;
	this.transformations = new dream.collection.Dict;
	this.transformations.onAdd.add(function(obj){
		obj.onChange.propagate(composite);
		obj.onPositionChange.propagate(composite);
		obj.onChange.add(obj.onPositionChange.add(function(){composite.isChanged = true;}));
		dream.event.dispatch(composite, &quot;onChange&quot;);
		composite.isChanged = true;
	});
	this.transformations.onRemove.add(function(obj){
		obj.onChange.removeByOwner(composite);
		dream.event.dispatch(composite, &quot;onChange&quot;);
		composite.isChanged = true;
	});
	this.transformations.addArray(transformations);
}.inherits(Transformation);
var $ = Composite.prototype;

Object.defineProperty($, &quot;hasTransform&quot;, {
	get : function () {
		for (var i=0, t; t = this.transformations[i]; i++ )
			if(t.hasTransform) return true;
		return false;

	}
});

$.updateMatrix = function(){
	var r = this.transformations[0];
	for (var i=1, m; m = this.transformations[i]; i++ )
		if(m.hasTransform) r = r.compose(m);
	
	this._matrix = r &amp;&amp; r.matrix || new Matrix();
};

$.apply = function(context, origin){ 	
&#x2F;&#x2F;	var m = this.matrix;
&#x2F;&#x2F;	context.transform(m.x0, m.y0, m.x1, m.y1, m.dx|0, m.dy |0);
&#x2F;&#x2F;	return new dream.Point;
	var o = origin;
	for (var i=0, t; t = this.transformations[i]; i++ ){
		if(t.hasTransform) o = t.apply(context, o);
	}
	return o;
};

&#x2F;**
 * 
 *&#x2F;
var Generic = function(left, top, scaleX, scaleY, rotation, anchorX, anchorY){
	Generic._superClass.apply(this);
	
	this._ax = -anchorX || 0;
	this._ay = -anchorY || 0;
	
	this.transformations.add(new Translation(left,top), &quot;translation&quot;);
	this.transformations.add(new Scale(scaleX, scaleY), &quot;scale&quot;);
	this.transformations.add(new Rotation(rotation), &quot;rotation&quot;);
	this.transformations.add(new Translation(-anchorX,-anchorY), &quot;anchor&quot;);
}.inherits(Composite);
var $ = Generic.prototype;

dream.util.createProperty($, &quot;left&quot;, &quot;transformations.translation.left&quot;);
dream.util.createProperty($, &quot;top&quot;, &quot;transformations.translation.top&quot;);
dream.util.createProperty($, &quot;scaleX&quot;, &quot;transformations.scale.x&quot;);
dream.util.createProperty($, &quot;scaleY&quot;, &quot;transformations.scale.y&quot;);
dream.util.createProperty($, &quot;rotation&quot;, &quot;transformations.rotation.angle&quot;);
Object.defineProperty($, &quot;anchorX&quot;, {
	get : function() {
		return -this.transformations.anchor.left;
	},
	set : function(v) {
		this.transformations.anchor.left = this._ax = -v;
	}
});
Object.defineProperty($, &quot;anchorY&quot;, {
	get : function() {
		return -this.transformations.anchor.top;
	},
	set : function(v) {
		this.transformations.anchor.top = this._ay = -v;
	}
});

$.apply = function(context, origin){

	if(this.transformations.scale.hasTransform || this.transformations.rotation.hasTransform){
		var m = this.matrix;
		context.transform(m.x0, m.y0, m.x1, m.y1, (m.dx|0) + origin.left, (m.dy|0) + origin.top);
		return new dream.Point;		
	}else{
		return new dream.Point((origin.left + this.transformations.translation.left + this._ax) |0,
						(origin.top + this.transformations.translation.top + this._ay) |0);
	}
};

&#x2F;&#x2F;Exporting
dream.transform = {
		DEG_TO_RAD: Math.PI&#x2F;180,
		RAD_TO_DEG: 180&#x2F;Math.PI,
		
		Matrix: Matrix,
		Transformation: Transformation,
		Identity: Identity,
		Translation: Translation,
		Rotation: Rotation,
		Scale: Scale,
		Custom: Custom,
		Composite: Composite,
		Generic: Generic		
};


})();
    </pre>
</div>

                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="..&#x2F;assets/vendor/prettify/prettify-min.js"></script>
<script>prettyPrint();</script>
<script src="..&#x2F;assets/js/yui-prettify.js"></script>
<script src="..&#x2F;assets/../api.js"></script>
<script src="..&#x2F;assets/js/api-filter.js"></script>
<script src="..&#x2F;assets/js/api-list.js"></script>
<script src="..&#x2F;assets/js/api-search.js"></script>
<script src="..&#x2F;assets/js/apidocs.js"></script>
</body>
</html>
