<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>src\util.js - DreamJs</title>
    <link rel="stylesheet" href="http:&#x2F;&#x2F;yui.yahooapis.com&#x2F;3.8.0&#x2F;build&#x2F;cssgrids&#x2F;cssgrids-min.css">
    <link rel="stylesheet" href="..&#x2F;assets/vendor/prettify/prettify-min.css">
    <link rel="stylesheet" href="..&#x2F;assets/css/main.css" id="site_styles">
    <link rel="shortcut icon" type="image/png" href="..&#x2F;assets/favicon.png">
    <script src="http:&#x2F;&#x2F;yui.yahooapis.com&#x2F;combo?3.8.0&#x2F;build&#x2F;yui&#x2F;yui-min.js"></script>
</head>
<body class="yui3-skin-sam">

<div id="doc">
    <div id="hd" class="yui3-g header">
        <div class="yui3-u-3-4">
            
                <h1><img src="..&#x2F;assets/css/logo.png" title="DreamJs"></h1>
            
        </div>
        <div class="yui3-u-1-4 version">
            <em>API Docs for: 0.0.8</em>
        </div>
    </div>
    <div id="bd" class="yui3-g">

        <div class="yui3-u-1-4">
            <div id="docs-sidebar" class="sidebar apidocs">
                <div id="api-list">
    <h2 class="off-left">APIs</h2>
    <div id="api-tabview" class="tabview">
        <ul class="tabs">
            <li><a href="#api-classes">Classes</a></li>
            <li><a href="#api-modules">Modules</a></li>
        </ul>

        <div id="api-tabview-filter">
            <input type="search" id="api-filter" placeholder="Type to filter APIs">
        </div>

        <div id="api-tabview-panel">
            <ul id="api-classes" class="apis classes">
            
                <li><a href="..&#x2F;classes/dream.dynamic.Action.html">dream.dynamic.Action</a></li>
            
                <li><a href="..&#x2F;classes/dream.dynamic.Animation.html">dream.dynamic.Animation</a></li>
            
                <li><a href="..&#x2F;classes/dream.dynamic.Dynamic.html">dream.dynamic.Dynamic</a></li>
            
                <li><a href="..&#x2F;classes/dream.dynamic.Tween.html">dream.dynamic.Tween</a></li>
            
            </ul>

            <ul id="api-modules" class="apis modules">
            
                <li><a href="..&#x2F;modules/dynamic.html">dynamic</a></li>
            
            </ul>
        </div>
    </div>
</div>

            </div>
        </div>
        <div class="yui3-u-3-4">
                <div id="api-options">
        Show:
        <label for="api-show-inherited">
            <input type="checkbox" id="api-show-inherited" checked>
            Inherited
        </label>

        <label for="api-show-protected">
            <input type="checkbox" id="api-show-protected">
            Protected
        </label>

        <label for="api-show-private">
            <input type="checkbox" id="api-show-private">
            Private
        </label>
        <label for="api-show-deprecated">
            <input type="checkbox" id="api-show-deprecated">
            Deprecated
        </label>

    </div>


            <div class="apidocs">
                <div id="docs-main">
                    <div class="content">
                        <h1 class="file-heading">File: src\util.js</h1>

<div class="file">
    <pre class="code prettyprint linenums">
&#x2F;**
 * 
 *&#x2F;
dream.util = {};

&#x2F;**
 * @param items
 * @constructor
 *&#x2F;
dream.util.ArrayList = function(items){
	this.keys = {};
	this._index = {};
	
	if(items) this.addArray(items);
}.inherits(Array);

dream.event.create(dream.util.ArrayList.prototype, &quot;onAdd&quot;);	
dream.event.create(dream.util.ArrayList.prototype, &quot;onRemove&quot;);

&#x2F;**
 * @param object
 * @param {string} [id]
 *&#x2F;
dream.util.ArrayList.prototype.add = function(object, id){
	&#x2F;&#x2F;dream.util.assert(object);
	var gid = dream.util.getId(object);
	if(this._index[gid]) return object;
	
	var nid = id || &quot;id&quot; + gid;
	if(this.keys[nid] != undefined) {console.log(nid+&quot; replaced!&quot;);this.remove(nid);};
	
	this._index[gid] = nid;
	this.keys[nid] = this.push(object) -1;
	this[nid] = object;
	dream.event.dispatch(this, &quot;onAdd&quot;, object);
	return object;
};

dream.util.ArrayList.prototype.indexOf = function(object){
	if(object instanceof Object){
		return this.keys[this._index[dream.util.getId(object)]];
	}else{
		return this.keys[object];	
	}
};

dream.util.ArrayList.prototype.removeByIndex = function(index){
	dream.util.assert(typeof index == &quot;number&quot;);
	var r = this.splice(index, 1)[0];
	dream.util.assert(r);
	var gid = dream.util.getId(r);
	var id = this._index[gid];
	delete this.keys[id];
	delete this._index[gid];
	delete this[id];
	for (var i=index, o; o = this[i]; i++ ){
		this.keys[this._index[dream.util.getId(o)]] --;		
	}
	dream.event.dispatch(this, &quot;onRemove&quot;, r);
	return r;
};

dream.util.ArrayList.prototype.remove = function(object){
	if(typeof object == &quot;number&quot;){
		return this.removeByIndex(i);
	}else{
		var i = this.indexOf(object);
		if(typeof i == &quot;number&quot;){
			return this.removeByIndex(i);
		}else{
			return false;
		}
	}
	
};

dream.util.ArrayList.prototype.replace = function(object, newObject, id){
	dream.util.assert(object);
	dream.util.assert(newObject);
	var gid = dream.util.getId(object);
	var ngid = dream.util.getId(newObject);
	var nid = id || &quot;id&quot; + ngid;
	
	var pid = this._index[gid];
	delete this._index[gid];
	this._index[ngid] = nid;
	var index = this.keys[pid];
	this.keys[nid] = index;
	delete this.keys[pid];
	this[index] = newObject;
	
	dream.event.dispatch(this, &quot;onRemove&quot;, object);
	dream.event.dispatch(this, &quot;onAdd&quot;, newObject);
	return newObject;
};

dream.util.ArrayList.prototype.clear = function(){
	for(var i=0, o; o = this[i]; i++){		
		dream.event.dispatch(this, &quot;onRemove&quot;, o);
		delete this[this._index[dream.util.getId(o)]];
		delete this[i];
	}
	this.splice(0, this.length);
	this.keys = [];
	this._index = [];
};

dream.util.ArrayList.prototype.addArray = function(items){
	items &amp;&amp; items.forEach(this.add, this);
};

dream.util.ArrayList.prototype.addJson = function(items){
	for(var i in items) 
		this.add(items[i], i);
};

&#x2F;**
 * @author Ehsan
 * @constructor
 *&#x2F;
dream.util.IndexedArrayList = function(indexes, items){	
	this.indexes = indexes;	
	this.index = {};
	for(var index in this.indexes){
		this.index[index] = {};
	}
	
	dream.util.IndexedArrayList._superClass.call(this, items);	
	
}.inherits(dream.util.ArrayList);

dream.util.IndexedArrayList.prototype.add = function(object, id){
	for(var index in this.indexes){
		var a = this.index[index][object[index]] || (this.index[index][object[index]] = []);
		a.push(object);

		var ar = this;
		
		if (this.indexes[index])
			object[this.indexes[index]].add(function(oldValue){
				var a = ar.index[index][oldValue];
				a.splice(a.indexOf(object),1);
				if(!a.length) delete ar.index[index][oldValue];
				var n = ar.index[index][this[index]] || (ar.index[index][this[index]] = []);
				n.push(object);
			});
		
	}
	return dream.util.IndexedArrayList._superClass.prototype.add.call(this, object, id);
};

&#x2F;**
 * @author Ehsan
 * @constructor
 *&#x2F;
dream.util.Selector = function(items){
	dream.util.Selector._superClass.call(this, items);	
	
}.inherits(dream.util.ArrayList);

dream.event.create(dream.util.Selector.prototype, &quot;onDeselect&quot;);
dream.event.create(dream.util.Selector.prototype, &quot;onSelect&quot;);

dream.util.Selector.prototype.selectObject = function(obj, i){
	&#x2F;&#x2F;dream.util.assert(obj != undefined);
	&#x2F;&#x2F;dream.event.dispatch(this, &quot;onDeselect&quot;, this._current);
	this._current = obj;
	this._currentIndex = i;
	dream.event.dispatch(this, &quot;onSelect&quot;, obj);
	return obj;
};

dream.util.Selector.prototype.select = function(obj){
	if(typeof obj == &quot;string&quot;){
		return this.selectObject(this[obj], this.indexOf(obj));
	}else if(typeof obj == &quot;number&quot;){
		return this.selectObject(this[obj], obj);
	}else{
		return this.selectObject(obj, this.indexOf(obj));
	}
};

dream.util.Selector.prototype.next = function(step){
	var i = this._currentIndex + (step || 1);
	this.select(i &gt;= this.length ? 0 : i);
};

dream.util.Selector.prototype.previous = function(step){
	var i = this._currentIndex - (step || 1);
	this.select(i &lt; 0 ? this.length -1  : i);
};

Object.defineProperty(dream.util.Selector.prototype, &quot;current&quot;, {
	get : function () {
		return this._current;
	},
	set : function (v) {
		this.selectObject(v);
	}
});

&#x2F;**
 * @author Ehsan
 * @constructor
 *&#x2F;
dream.util.EventDispatcher = function(obj, name){
	dream.util.EventDispatcher._superClass.call(this);
	
	this.obj = obj;	
	this.name = name;
	
	this.listeners = {};
	
}.inherits(dream.collection.List);

dream.util.EventDispatcher.prototype.add = function(fn, owner){
	var h = dream.util.EventDispatcher._superClass.prototype.add.call(this, fn, typeof owner == &quot;string&quot; ? owner : null);
	if(owner){
		var oid = dream.util.getId(owner);
		var l = this.listeners[oid] || (this.listeners[oid] = []);
		l.push(this.length);
	}
	
	if(this.length == 1){
		this.dispatch = this[0].bind(this.obj);
	}else{
		delete this.dispatch;
	}
	
	return h;
};

dream.util.EventDispatcher.prototype.addTemp = function(object, owner){
	var tmpFn, event = this;
	this.add(tmpFn = function(){
		event.remove(tmpFn);
		object &amp;&amp; object.call(this);		
	}, owner);
};

dream.util.EventDispatcher.prototype.removeByOwner = function(owner){
	var oid = dream.util.getId(owner), l;
	if(l = this.listeners[oid]){
		for(var i = 0, ll = l.length; i &lt; ll; i++)
			this.removeByIndex(i);
		delete this.listeners[oid];
	}
};

dream.util.EventDispatcher.prototype.dispatch = function(){
	var obj = this.obj;
	for(var i = 0, l = this.length; i &lt; l; i++)
		this[i].apply(obj, arguments);
		
};

dream.util.EventDispatcher.prototype.propagate = function(target, event){
	var e = event || this.name;
	var maps = Array.prototype.splice.call(arguments, 2, arguments.length);
	return this.add( maps.length ? 
		function(){
			for(var i = 0, m; m = maps[i]; i++)
				arguments[i] = m.call(target, arguments[i]);			
				
			if(arguments.length &lt; maps.length) arguments.length = maps.length;
			
			var dispatcher;
			if(target.__events &amp;&amp; (dispatcher = target.__events[e]))
				dispatcher.dispatch.apply(dispatcher, arguments);
				
		} : 
		function(){
			var dispatcher;
			if(target.__events &amp;&amp; (dispatcher = target.__events[e]))
				dispatcher.dispatch.apply(dispatcher, arguments);
			
		},
	target);
};

dream.util.EventDispatcher.prototype.propagateFlagged = function(target, flag){
	return this.add(function(){
		target[flag] = true;
	});
};

&#x2F;**
 * @constructor
 *&#x2F;
dream.util.AssetLibrary = function(){
	dream.util.AssetLibrary._superClass.call(this);
	
	this.loader = new dream.static.Loader();
}.inherits(dream.collection.List);

dream.util.AssetLibrary.prototype.prepare = function(callBack){
	if(this.loader.isRequestSent){
		this.loader.abort();
	}
	this.loader.resources = this.requiredResources;
	this.loader.load(callBack);
};

Object.defineProperty(dream.util.AssetLibrary.prototype, &quot;requiredResources&quot;, {
	get : function () {
		var r = new dream.collection.Set;
		for(var i=0,asset; asset=this[i]; i++ )
			r.addArray(asset.requiredResources);
		return r;
	}
});

&#x2F;**
 * @author Ehsan
 * @constructor
 *&#x2F;
dream.util.RedrawRegionList = function(){
}.inherits(Array);

dream.util.RedrawRegionList.prototype.add = function(rect){
	if(rect.width &lt;=0 || rect.height &lt;= 0) return false;
	for(var i = 0, r; r = this[i]; i++)
		if(rect.hasIntersectWith(r))
			return this.add(this.splice(i,1)[0].add(rect));
	
	return this.push(rect);
};

&#x2F;&#x2F;dream.util.RedrawRegionList.prototype.addArray = dream.util.ArrayList.prototype.addArray;
dream.util.RedrawRegionList.prototype.addArray = function(items){
	if(items instanceof dream.util.RedrawRegionList)
		for(var i = 0, o; o = items[i]; i++)
			this.push(o);
	else
		for(var i = 0, o; o = items[i]; i++)
			this.add(o);
		
};

dream.util.RedrawRegionList.prototype.clear = function(){
	this.splice(0, this.length);
};

&#x2F;**
 * @constructor
 *&#x2F;
dream.util.BufferCanvas = function(width, height){
	this.canvas = document.createElement(&quot;canvas&quot;);

	this.canvas.width = width;
	this.canvas.height = height;
	this.context = this.canvas.getContext(&quot;2d&quot;);	
};

dream.util.getRequestAnimationFrame = function(fps) {
	if(fps){
		return function(callback, element) {
			return window.setTimeout(callback, 1000 &#x2F; fps);
		};
	}else{
		return window.requestAnimationFrame
			|| window.webkitRequestAnimationFrame
			|| window.mozRequestAnimationFrame
			|| window.oRequestAnimationFrame
			|| window.msRequestAnimationFrame
			|| function(callback, element) {
				return window.setTimeout(callback, 1000 &#x2F; 60);
			};
	}
};

dream.util.getCancelRequestAnimationFrame = function(fps) {
	if(fps){
		return window.clearTimeout;
	}else{
		return window.cancelRequestAnimationFrame
			|| window.webkitCancelRequestAnimationFrame
			|| window.mozCancelRequestAnimationFrame
			|| window.oCancelRequestAnimationFrame
			|| window.msCancelRequestAnimationFrame
			|| window.clearTimeout;
	}
};

dream.util.assert = function(assertion, message){
	if(!assertion) throw new Error(&quot;Assertion failed! &quot; + (message || &quot;&quot;));
};

dream.util.objCount = 0;

dream.util.getId = function(obj){
	return obj.__GID || (obj.__GID = ++dream.util.objCount);
};

dream.util.createProperty = function(obj, name, shadowVariable){
	var sv = shadowVariable || &quot;_&quot;+name;
	return Object.defineProperty(obj, name, {
		get : new Function(&quot;return this.&quot;+sv),
		set : new Function(&quot;v&quot;, &quot;this.&quot;+sv+&quot;=v;&quot;)
	});
};

dream.util.createEventProperty = function(obj, name, changeEvent, shadowVariable){
	var e = changeEvent || &quot;onChange&quot;, sv = shadowVariable || &quot;_&quot;+name;
	return Object.defineProperty(obj, name, {
		get : new Function(&quot;return this.&quot;+sv),
		set : new Function(&quot;v&quot;, &quot;var o = this.&quot;+sv+&quot;;this.&quot;+sv+&quot;=v;dream.event.dispatch(this, &#x27;&quot;+e+&quot;&#x27;, o);&quot;)
	});
};

dream.util.createFlagProperty = function(obj, name, changeFlag, shadowVariable){
	var f = changeFlag || &quot;isChanged&quot;, sv = shadowVariable || &quot;_&quot;+name;
	return Object.defineProperty(obj, name, {
		get : new Function(&quot;return this.&quot;+sv),
		set : new Function(&quot;v&quot;, &quot;var o = this.&quot;+sv+&quot;;this.&quot;+sv+&quot;=v; if(v!=o) this.&quot;+f+&quot; = true;&quot;)
	});
};

dream.util.createEventFlagProperty = function(obj, name, changeEvent, changeFlag, shadowVariable){
	var e = changeEvent || &quot;onChange&quot;,f = changeFlag || &quot;isChanged&quot;, sv = shadowVariable || &quot;_&quot;+name;
	return Object.defineProperty(obj, name, {
		get : new Function(&quot;return this.&quot;+sv),
		set : new Function(&quot;v&quot;, &quot;var o = this.&quot;+sv+&quot;;this.&quot;+sv+&quot;=v;dream.event.dispatch(this, &#x27;&quot;+e+&quot;&#x27;, o);if(v!=o) this.&quot;+f+&quot; = true;&quot;)
	});
};

dream.util.profile = function(fn, samples){
	var s = samples || 100;
	var sum = 0, min = 0, max = 0;
	for(var i = 0; i &lt; s; i++){
		var t0 = performance.now();
		fn();
		var r = performance.now() - t0;
		
		if(i == 0){
			sum = min = max = r;
		}else{
			sum += r;
			min = r &lt; min ? r : min;
			max = r &gt; max ? r : max;
		}
	}
	
	return {avg: sum&#x2F;s, min: min, max: max, samples: s, toString: function(){return this.avg+&quot;x&quot;+this.samples+&quot; +&quot;+this.max+&quot; -&quot;+this.min}};
};

    </pre>
</div>

                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="..&#x2F;assets/vendor/prettify/prettify-min.js"></script>
<script>prettyPrint();</script>
<script src="..&#x2F;assets/js/yui-prettify.js"></script>
<script src="..&#x2F;assets/../api.js"></script>
<script src="..&#x2F;assets/js/api-filter.js"></script>
<script src="..&#x2F;assets/js/api-list.js"></script>
<script src="..&#x2F;assets/js/api-search.js"></script>
<script src="..&#x2F;assets/js/apidocs.js"></script>
</body>
</html>
