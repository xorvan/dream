<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>src\scenery.js - DreamJs</title>
    <link rel="stylesheet" href="http:&#x2F;&#x2F;yui.yahooapis.com&#x2F;3.8.0&#x2F;build&#x2F;cssgrids&#x2F;cssgrids-min.css">
    <link rel="stylesheet" href="..&#x2F;assets/vendor/prettify/prettify-min.css">
    <link rel="stylesheet" href="..&#x2F;assets/css/main.css" id="site_styles">
    <link rel="shortcut icon" type="image/png" href="..&#x2F;assets/favicon.png">
    <script src="http:&#x2F;&#x2F;yui.yahooapis.com&#x2F;combo?3.8.0&#x2F;build&#x2F;yui&#x2F;yui-min.js"></script>
</head>
<body class="yui3-skin-sam">

<div id="doc">
    <div id="hd" class="yui3-g header">
        <div class="yui3-u-3-4">
            
                <h1><img src="..&#x2F;assets/css/logo.png" title="DreamJs"></h1>
            
        </div>
        <div class="yui3-u-1-4 version">
            <em>API Docs for: 0.0.8</em>
        </div>
    </div>
    <div id="bd" class="yui3-g">

        <div class="yui3-u-1-4">
            <div id="docs-sidebar" class="sidebar apidocs">
                <div id="api-list">
    <h2 class="off-left">APIs</h2>
    <div id="api-tabview" class="tabview">
        <ul class="tabs">
            <li><a href="#api-classes">Classes</a></li>
            <li><a href="#api-modules">Modules</a></li>
        </ul>

        <div id="api-tabview-filter">
            <input type="search" id="api-filter" placeholder="Type to filter APIs">
        </div>

        <div id="api-tabview-panel">
            <ul id="api-classes" class="apis classes">
            
                <li><a href="..&#x2F;classes/dream.dynamic.Action.html">dream.dynamic.Action</a></li>
            
                <li><a href="..&#x2F;classes/dream.dynamic.Animation.html">dream.dynamic.Animation</a></li>
            
                <li><a href="..&#x2F;classes/dream.dynamic.Dynamic.html">dream.dynamic.Dynamic</a></li>
            
                <li><a href="..&#x2F;classes/dream.dynamic.Tween.html">dream.dynamic.Tween</a></li>
            
            </ul>

            <ul id="api-modules" class="apis modules">
            
                <li><a href="..&#x2F;modules/dynamic.html">dynamic</a></li>
            
            </ul>
        </div>
    </div>
</div>

            </div>
        </div>
        <div class="yui3-u-3-4">
                <div id="api-options">
        Show:
        <label for="api-show-inherited">
            <input type="checkbox" id="api-show-inherited" checked>
            Inherited
        </label>

        <label for="api-show-protected">
            <input type="checkbox" id="api-show-protected">
            Protected
        </label>

        <label for="api-show-private">
            <input type="checkbox" id="api-show-private">
            Private
        </label>
        <label for="api-show-deprecated">
            <input type="checkbox" id="api-show-deprecated">
            Deprecated
        </label>

    </div>


            <div class="apidocs">
                <div id="docs-main">
                    <div class="content">
                        <h1 class="file-heading">File: src\scenery.js</h1>

<div class="file">
    <pre class="code prettyprint linenums">
&#x2F;**
 * 
 *&#x2F;
dream.scenery = {};

&#x2F;**
 * @constructor
 *&#x2F;
dream.scenery.Scene = function(){
	dream.scenery.Scene._superClass.call(this);
	var scene = this;
	
	this.screenBoundary = new dream.Rect; 
	this.viewport = new dream.Rect; 
	
	this.renderDistanceX = 1;
	this.renderDistanceY = 1;
	
	this.areaChangeRate = .5;
	
	
	this.loader = new dream.static.Loader();
	
	this.assets = new dream.util.AssetLibrary();
	
	this.assets.onAdd.add(function(o){
		o.__IS_PERSIST = true;
		scene.pool.add(o);
	});
	this.assets.onRemove.add(this.pool.remove.bind(this.pool));
	
	this.providers = new dream.collection.Dict;
	this.providers.onAdd.add(function(provider){
		provider.init(scene.pool);
	});
	
	this.pool.onAdd.add(function(a){
				
		scene.addToRect(a);
		
		a.isImageChanged = true;
		
		a.onBoundaryChange.add(function(){
			scene.addToRect(this);
			scene.checkPresence(this);
		}, scene);
		
		if(!scene._isDirty)
			a.onImageChange.add(function(rects){
				scene.redrawRegions.addArray(rects);
			}, scene);
	});
	
	
	this.pool.onRemove.add(function(o){
		o.onBoundaryChange.removeByOwner(scene);
		o.onImageChange.removeByOwner(scene);
		o.onZChange.removeByOwner(scene);
		o.isPresent = false;
		if(o.isPresent) scene.renderList[o.z].splice(scene.renderList[o.z].indexOf(o),1);
	});
	
	this.area = new dream.Rect;
	this.onResize.add(this.onBoundaryChange.add(function(){
		scene.viewport = scene.rect.transformation.unprojectRect(scene.screenBoundary).boundary;
		if(scene.viewport.width == 0 &amp;&amp; scene.viewport.height == 0) this.pool.clear();
		var area = scene.viewport.clone();
		var vpw = area.width;
		var vph = area.height;
		area.left -= area.width * scene.renderDistanceX;
		area.top -= area.height * scene.renderDistanceY;
		area.width += area.width * 2 * scene.renderDistanceX;
		area.height += area.height * 2 * scene.renderDistanceY;
		var intersection = scene.area.getIntersectWith(area);
		if(area.width - intersection.width &gt; vpw * scene.renderDistanceX * scene.areaChangeRate ||  
				area.height - intersection.height &gt; vph * scene.renderDistanceY * scene.areaChangeRate){
			
			scene.area = area;
			
			if(this.providers.length){
				for(var i=0; i&lt;scene.pool.length; i++){
					var o = scene.pool[i];
					if(!o.__IS_PERSIST &amp;&amp; !o.boundary.hasIntersectWith(area)){
						scene.pool.removeByIndex(i);
						i--;
					}
				}
				
				for(var i=0, p; p = scene.providers[i]; i++){
					p.area = area;
				}				
			}
			
		}
		
		for(var i = 0, o; o = scene.pool[i]; i++ ){
			scene.checkPresence(o);

		}

	}));
	
	this.camera = new dream.scenery.Camera(this);
}.inherits(dream.visual.Composite);

dream.event.create(dream.scenery.Scene.prototype, &quot;onResize&quot;);

dream.scenery.Scene.prototype.checkPresence = function(o){
	var scene = this;
	if(!o.isPresent &amp;&amp; scene.viewport.hasIntersectWith(o.boundary)){
		o.isPresent = true;
		var z = o.z;
		(scene.renderList[z] || (scene.renderList[z] = [])).push(o);
		o.onZChange.add(function(oldZ){
			var ol = scene.renderList[oldZ];
			ol.splice(ol.indexOf(this), 1);
			(scene.renderList[this.z] || (scene.renderList[this.z] = [])).push(this);
		}, scene);

	}else if(o.isPresent &amp;&amp; !scene.viewport.hasIntersectWith(o.boundary)){
		o.isPresent = false;
		scene.renderList[o.z].splice(scene.renderList[o.z].indexOf(o),1);
		o.onZChange.removeByOwner(scene);
	}
};

Object.defineProperty(dream.scenery.Scene.prototype, &quot;requiredResources&quot;, {
	get : function () {
		var r = this.assets.requiredResources;
		for(var i=0; i&lt;this.providers.length; i++)
			r.addArray(this.providers[i].requiredResources);
		return r;
	}
});

dream.scenery.Scene.prototype.prepare = function(callBack){
	if(this.loader.isRequestSent){
		this.loader.abort();
	}
	this.loader.resources = this.requiredResources;
	this.loader.load(callBack);
};

&#x2F;**
 * @constructor
 *&#x2F;
dream.scenery.Camera = function(scene){
	this.scene = scene;
	
}.inherits(dream.Rect);

Object.defineProperty(dream.scenery.Camera.prototype, &quot;left&quot;, {
	set : function(v){this.scene.anchorX = v;},
	get : function(){ return this.scene.anchorX;}
});

Object.defineProperty(dream.scenery.Camera.prototype, &quot;top&quot;, {
	set : function(v){this.scene.anchorY = v;},
	get : function(){ return this.scene.anchorY;}
});

Object.defineProperty(dream.scenery.Camera.prototype, &quot;width&quot;, {
	get : function(){ return this.scene.width;}
});

Object.defineProperty(dream.scenery.Camera.prototype, &quot;height&quot;, {
	get : function(){ return this.scene.height;}
});

Object.defineProperty(dream.scenery.Camera.prototype, &quot;scale&quot;, {
	set : function(v){this.scene.scale = v;},
	get : function(){ return this.scene.scale;}
});

Object.defineProperty(dream.scenery.Camera.prototype, &quot;rotation&quot;, {
	set : function(v){this.scene.rotation = v * -1;},
	get : function(){ return this.scene.rotation * -1;}
});
    </pre>
</div>

                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="..&#x2F;assets/vendor/prettify/prettify-min.js"></script>
<script>prettyPrint();</script>
<script src="..&#x2F;assets/js/yui-prettify.js"></script>
<script src="..&#x2F;assets/../api.js"></script>
<script src="..&#x2F;assets/js/api-filter.js"></script>
<script src="..&#x2F;assets/js/api-list.js"></script>
<script src="..&#x2F;assets/js/api-search.js"></script>
<script src="..&#x2F;assets/js/apidocs.js"></script>
</body>
</html>
