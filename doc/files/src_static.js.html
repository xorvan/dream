<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>src\static.js - DreamJs</title>
    <link rel="stylesheet" href="http:&#x2F;&#x2F;yui.yahooapis.com&#x2F;3.8.0&#x2F;build&#x2F;cssgrids&#x2F;cssgrids-min.css">
    <link rel="stylesheet" href="..&#x2F;assets/vendor/prettify/prettify-min.css">
    <link rel="stylesheet" href="..&#x2F;assets/css/main.css" id="site_styles">
    <link rel="shortcut icon" type="image/png" href="..&#x2F;assets/favicon.png">
    <script src="http:&#x2F;&#x2F;yui.yahooapis.com&#x2F;combo?3.8.0&#x2F;build&#x2F;yui&#x2F;yui-min.js"></script>
</head>
<body class="yui3-skin-sam">

<div id="doc">
    <div id="hd" class="yui3-g header">
        <div class="yui3-u-3-4">
            
                <h1><img src="..&#x2F;assets/css/logo.png" title="DreamJs"></h1>
            
        </div>
        <div class="yui3-u-1-4 version">
            <em>API Docs for: 0.0.8</em>
        </div>
    </div>
    <div id="bd" class="yui3-g">

        <div class="yui3-u-1-4">
            <div id="docs-sidebar" class="sidebar apidocs">
                <div id="api-list">
    <h2 class="off-left">APIs</h2>
    <div id="api-tabview" class="tabview">
        <ul class="tabs">
            <li><a href="#api-classes">Classes</a></li>
            <li><a href="#api-modules">Modules</a></li>
        </ul>

        <div id="api-tabview-filter">
            <input type="search" id="api-filter" placeholder="Type to filter APIs">
        </div>

        <div id="api-tabview-panel">
            <ul id="api-classes" class="apis classes">
            
            </ul>

            <ul id="api-modules" class="apis modules">
            
            </ul>
        </div>
    </div>
</div>

            </div>
        </div>
        <div class="yui3-u-3-4">
                <div id="api-options">
        Show:
        <label for="api-show-inherited">
            <input type="checkbox" id="api-show-inherited" checked>
            Inherited
        </label>

        <label for="api-show-protected">
            <input type="checkbox" id="api-show-protected">
            Protected
        </label>

        <label for="api-show-private">
            <input type="checkbox" id="api-show-private">
            Private
        </label>
        <label for="api-show-deprecated">
            <input type="checkbox" id="api-show-deprecated">
            Deprecated
        </label>

    </div>


            <div class="apidocs">
                <div id="docs-main">
                    <div class="content">
                        <h1 class="file-heading">File: src\static.js</h1>

<div class="file">
    <pre class="code prettyprint linenums">
&#x2F;**
 * 
 *&#x2F;
(function(window){
	

&#x2F;**
 * 
 *&#x2F;
var cache = {};

&#x2F;**
 * 
 *&#x2F;
var normalizeUrl = function(url){
    var a = document.createElement(&#x27;a&#x27;);
    a.href = url;
    return a.href;
};

&#x2F;**
 * @param {Array&lt;dream.preload.Resource&gt;} resources
 * @constructor
 *&#x2F;
var Loader = function(resources){
	this.loadedCount = 0;
	this.resources = resources || [];
	
	this.isRequestSent = false;
};
var $ = Loader.prototype;

dream.event.create($, &quot;onLoad&quot;);
dream.event.create($, &quot;onProgress&quot;);

$.load = function(callBack){
	
	if(this.isRequestSent || this.resources.length == 0){
		callBack.call(this);
	}else{
		this.onLoad.addTemp(callBack);
		this.isRequestSent = true;
		this.loadedCount = 0;
		
		var loader = this;
		
		for(var i = 0, res; res = this.resources[i]; i++){
			res.load(function(){
				loader.loadedCount++;
				
				dream.event.dispatch(loader, &quot;onProgress&quot;);
				
				if(loader.loadedCount == loader.resources.length){
					dream.event.dispatch(loader, &quot;onLoad&quot;);
				}
			});
		}
	}
};

$.reload = function(callBack){
	this.abort();	
	this.load(callBack);
};

$.abort = function(){
	this.isRequestSent = false;
	for(var i = 0, res; res = this.resources[i]; i++ )
		res.abort();
};

&#x2F;**
 * @constructor
 *&#x2F;
var Resource = function(url){
	this.content = null;
	this.loader = null;
	this.dependencies = [];
	this.isLoaded = false;
	this.isRequestSent = false;
	
	if(url){
		var option, options = url.split(&quot;;&quot;);
		this.url = normalizeUrl(options[0]);
		this.forcedMimeType = (option = options[1] &amp;&amp; options[1].split(&quot;:&quot;)) &amp;&amp; (option[0].trim() == &quot;Content-Type&quot; &amp;&amp; option[1].trim());
		return cache[this.url] || (cache[this.url] = this.url.indexOf(&quot;#&quot;) == -1 ? this : new Fragment(this.url));
	}
};
var $ = Resource.prototype;

dream.event.create($, &quot;onLoad&quot;);
dream.event.create($, &quot;onSelfLoad&quot;);
dream.event.create($, &quot;onProgress&quot;);

$.load = function(callBack){
	if(!this.isRequestSent){
		this.isRequestSent = true;
		this.doLoad(callBack);
	}else{
		callBack &amp;&amp; callBack.call(this);
	}
};

$.reload = function(callBack){
	this.abort();	
	this.load(callBack);
};

$.abort = function(){
	this.isRequestSent = false;
	
	if(this.xhr){
		this.xhr.abort();
		delete this.xhr;
		if(this.depLoader){
			this.depLoader.cancel();
			delete this.depLoader;
		}
	}
	
	for(var i = 0, res; res = this.dependencies[i]; i++ )
		res.abort();
};

$.doLoad = function(callBack){
	var res = this;
	
	if(callBack) this.onLoad.addTemp(callBack);
	
	var xhr = this.xhr = new XMLHttpRequest();
	
	if (xhr.overrideMimeType &amp;&amp; this.forcedMimeType)
		xhr.overrideMimeType(this.forcedMimeType);
	
	xhr.onprogress = function(e){
		dream.event.dispatch(res, &quot;onProgress&quot;, e);
	};
	
	xhr.onreadystatechange = function(){
		if(this.readyState == this.HEADERS_RECEIVED) {
			var mime = res.forcedMimeType || this.getResponseHeader(&quot;Content-Type&quot;),
				loaderClass = ResourceLoader.getResourceLoader(mime);
			
			if(!loaderClass) throw new Error(&quot;Cannot load resource with Content-Type &#x27;&quot;+ mime + &quot;&#x27;!&quot;);
			
			res.loader = new loaderClass(this, res.url, function(){
				res.content = res.loader.content;
				res.dependencies = res.loader.dependencies;
				
				if(!res.isLoaded )
					dream.event.dispatch(res, &quot;onSelfLoad&quot;);
				
				if(this.dependencies &amp;&amp; this.dependencies.length &gt; 0){
					var l = this.depLoader = new Loader(this.dependencies);
					l.onLoad.add(function(){
						res.isLoaded = true;
						dream.event.dispatch(res, &quot;onLoad&quot;);
					});
					l.load();
				}else{
					res.isLoaded = true;
					dream.event.dispatch(res, &quot;onLoad&quot;);
				}
			});
		}
	};
	xhr.open(&quot;GET&quot;, this.url, true);
	xhr.send();
};

&#x2F;**
 * 
 * @constructor
 * @extends dream.preload.Resource
 *&#x2F;
Fragment = function(url){
	Fragment._superClass.call(this);
	
	var s = url.split(&quot;#&quot;);
	this.resource = new Resource(s[0]);
	this.hash = s[1];
	
}.inherits(Resource);
var $ = Fragment.prototype;

$.doLoad = function(callBack){
	this.isLoaded = true;
	dream.event.dispatch(this, &quot;onSelfLoad&quot;);
	
	var fragment = this;
	this.resource.load(function(){
		fragment.content = this.loader.getContent(fragment.hash);
		callBack &amp;&amp; callBack.call(this);
	});
};

Object.defineProperty($, &quot;dependencies&quot;, {
	get : function () {
		return [this.resource];
	}
});

&#x2F;**
 * @constructor
 *&#x2F;
var ResourceLoader = function(xhr, url){
	this.content = null;
	this.url = url;
	this.dependencies = [];
};
var $ = ResourceLoader.prototype;

$.getContent = function(fragment){
	return this.content;
}

ResourceLoader.loaders = [];

ResourceLoader.register = function(resourceLoader){
	ResourceLoader.loaders.push(resourceLoader);
};

ResourceLoader.getResourceLoader = function(mime){
	for(var i = ResourceLoader.loaders.length - 1, loader; loader = ResourceLoader.loaders[i]; i--)
		if(loader.mimeType.exec(mime))
			return loader;
	return null;
};

ResourceLoader.Type = {
		TEXT: &quot;text&quot;,
		BLOB: &quot;blob&quot;,
		DOCUMENT: &quot;document&quot;
	};

&#x2F;**
 * @constructor
 * @extends dream.static.ResourceLoader
 *&#x2F;
var BlobResourceLoader = function(xhr, url){
	BlobResourceLoader._superClass.call(this, xhr, url);
	
	try{
		if(xhr &amp;&amp; xhr.responseType != undefined)
			xhr.responseType = ResourceLoader.Type.BLOB;
	}catch(e){console.log(e);}
	
}.inherits(ResourceLoader);

&#x2F;**
 * @constructor
 * @extends dream.static.BlocResourceLoader
 *&#x2F;
var ImageResourceLoader = function(xhr, url, onLoad){
	ImageResourceLoader._superClass.call(this, xhr, url);
	
	var rl = this;

	if(xhr.responseType == ResourceLoader.Type.BLOB){
		xhr.onload = function(ev) {
			var img = new Image();
			img.onload = function(e) {
				window.URL.revokeObjectURL(img.src);
				onLoad();
			};
			img.src = window.URL.createObjectURL(this.response);
			rl.content = img;
		};
	}else{
		xhr.abort();
		var img = new Image();
		img.onload = function(){
			rl.content = img;
			onLoad();
		};
		img.src = url;
		
	}
	
		
}.inherits(BlobResourceLoader);

ImageResourceLoader.mimeType = &#x2F;image\&#x2F;(.+)&#x2F;;
ResourceLoader.register(ImageResourceLoader);

&#x2F;**
 * @constructor
 * @extends dream.static.ResourceLoader
 *&#x2F;
var DocumentResourceLoader = function(xhr, url, onLoad){
	DocumentResourceLoader._superClass.call(this, xhr, url);
	
	if(xhr){
		if(xhr.responseType != undefined) 
			xhr.responseType = ResourceLoader.Type.DOCUMENT;
		
		xhr.onload = function(ev) {
			rl.content = this.responseType == ResourceLoader.Type.DOCUMENT ? this.response : this.responseXML;
			onLoad();
		};
	}
	
}.inherits(ResourceLoader);

DocumentResourceLoader.mimeType = &#x2F;(text\&#x2F;xml) | (application\&#x2F;xml)&#x2F;;
ResourceLoader.register(DocumentResourceLoader);

&#x2F;**
 * @constructor
 * @extends dream.static.DocumentResourceLoader
 *&#x2F;
var TiledMapResourceLoader = function(xhr, url, onLoad){
	TiledMapResourceLoader._superClass.call(this, xhr, onLoad);
	
}.inherits(DocumentResourceLoader);

TiledMapResourceLoader.mimeType = &#x2F;application\&#x2F;tiled-map+xml&#x2F;;

Object.defineProperty(TiledMapResourceLoader.prototype, &quot;dependencies&quot;, {
	get : function () {
		if(this.content){
			var dep = [];
			var pre = &#x2F;^(.*\&#x2F;).*$&#x2F;.exec(this.url);
			pre = pre ? pre[1] : &quot;&quot;;
			var images = this.content.getElementsByTagName(&quot;image&quot;);
			for(var i=0,image; image = images[i]; i++){
				dep.push(new dream.static.ImageResource(pre+image.getAttribute(&quot;source&quot;)));
			}
			return dep.length? dep : null;
		}else{
			return null;
		}
	}
});

ResourceLoader.register(TiledMapResourceLoader);

dream.static = {
		Loader: Loader,
		Resource: Resource,
		ResourceLoader: ResourceLoader,
		BlobResourceLoader: BlobResourceLoader,
		ImageResourceLoader: ImageResourceLoader,
		DocumentResourceLoader: DocumentResourceLoader,
		TiledMapResourceLoader: TiledMapResourceLoader,
		normalizeUrl: normalizeUrl,
		cache: cache
};

})(window);
    </pre>
</div>

                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="..&#x2F;assets/vendor/prettify/prettify-min.js"></script>
<script>prettyPrint();</script>
<script src="..&#x2F;assets/js/yui-prettify.js"></script>
<script src="..&#x2F;assets/../api.js"></script>
<script src="..&#x2F;assets/js/api-filter.js"></script>
<script src="..&#x2F;assets/js/api-list.js"></script>
<script src="..&#x2F;assets/js/api-search.js"></script>
<script src="..&#x2F;assets/js/apidocs.js"></script>
</body>
</html>
