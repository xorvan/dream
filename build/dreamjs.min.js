/*! DreamJS  0.0.8  2013-04-06 */
dream.Behaviour=function(){},dream.behaviour={},dream.Screen=function(t,e,i,n,r,s){var o=this;this.scaleMode=dream.Screen.ScaleMode.SHOW_ALL,void 0!=s&&(this.scaleMode=s),this.fc=0,this._frameRate=0,this.frameRate=this._frameRate,this.canvas=t,this.context=this.canvas.getContext("2d"),this.minWidth=e||this.canvas.width,this.minHeight=i||this.canvas.height,this.maxWidth=n||this.minWidth,this.maxHeight=r||this.minHeight,this.width=this.canvas.width,this.height=this.canvas.height,this.rect=new dream.Rect(0,0,this.width,this.height,new dream.transform.Scale),this.redrawRegions=new dream.util.RedrawRegionList,this.rerenderBuffer=new dream.util.BufferCanvas(0,0),this.input=new dream.input.InputHandler(this),this.scenes=new dream.collection.Selector,this.scenes.onSelect.add(function(t){t.screenBoundary.width=o.width,t.screenBoundary.height=o.height,o.hovered=null,o.redrawRegions.add(new dream.Rect(0,0,o.width,o.height)),t.onBoundaryChange.add(function(){o.redrawRegions.add(new dream.Rect(0,0,this.viewport.width,this.viewport.height))},o),t.onImageChange.add(function(t){o.redrawRegions.addArray(t)},o),t.prepare(function(){o.render(t)}),dream.event.dispatch(t,"onResize")}),this.scenes.onDeselect.add(function(t){t.onBoundaryChange.removeByOwner(o),t.onImageChange.removeByOwner(o),t.screenBoundary.width=0,t.screenBoundary.height=0,dream.event.dispatch(t,"onResize"),prevScene=t}),this.updateSize(),window.addEventListener("resize",function(){o.updateSize()},!1),window.addEventListener("orientationchange ",function(){o.updateSize()},!1)}.inherits(dream.VisualAsset),dream.event.create(dream.VisualAsset.prototype,"onResize"),dream.Screen.prototype.pause=function(){var t=this.cancelRequestAnimationFrameFunction;t(this._AFID),this.isdrawing=!1},dream.Screen.prototype.resume=function(){this.render()},dream.Screen.prototype.render=function(){this.fc++,dream.fc++;var t=0==this.fc%this.input.interval;if(t){var e;for(var i in this.input.downKeys){if(e=this.keyBindings.index.key[i])for(var n,r=0;n=e[r];r++)n.fn(this.input.downKeys[i]);this.input.downKeys[i]++}}if(this.paint(this.context,new dream.Point,new dream.Rect(0,0,this.width,this.height)),t&&(this.checkHover(new dream.input.MouseEvent(null,this.input.mouse.position,this)),this.input.mouse.isDown&&this.raiseDrag(new dream.input.MouseEvent(null,this.input.mouse.position,this))),!this.isdrawing){this.isdrawing=!0;var s=this,o=this.requestAnimationFrameFunction;this._AFID=o(function(){s.isdrawing=!1,s.render()})}},dream.Screen.prototype.paintWithoutRedrawRegion=function(t,e,i){var n=this.scenes.current;n.step(),t.clearRect(0,0,i.width,i.height),n.render(t,new dream.Point,i)},dream.Screen.prototype.paintWithClippingRedrawRegion=function(t,e,i){var n=0,r=this.scenes.current;r.step();for(var s,o=0,a=this.redrawRegions.length;a>o;o++){var h=this.redrawRegions[o];if(s=h.getIntersectWith(i)){var d=(0|s.left)-1,c=(0|s.top)-1,u=(0|s.width)+2,p=(0|s.height)+2;t.save(),t.beginPath(),t.rect(d,c,u,p),t.clip(),t.closePath(),n++,t.clearRect(d,c,u,p),r.render(t,e,new dream.Rect(d,c,u,p)),t.restore()}}this.redrawRegions.clear()},dream.Screen.prototype.paintWithBufferdRedrawRegion=function(t,e,i){var n=0,r=this.scenes.current;r.step();for(var s,o=0,a=this.redrawRegions.length;a>o;o++)if(s=rr.getIntersectWith(i)){var h=this.rerenderBuffer;h.canvas.width=s.width,h.canvas.height=s.height,n++,t.clearRect(s.left,s.top,s.width,s.height),r.render(h.context,new dream.Point(-s.left,-s.top),s),t.drawImage(h.canvas,0,0,s.width,s.height,s.left,s.top,s.width,s.height)}this.redrawRegions.clear()},dream.Screen.prototype.paint=dream.Screen.prototype.paintWithClippingRedrawRegion,dream.Screen.prototype.checkHover=function(t){this.isHovered&&(this.hovered||(this.hovered=this.scenes.current,dream.event.dispatch(this,"onMouseEnter",t)),this.hovered.checkHover(t.toLocal(this.hovered)))},dream.Screen.prototype.updateSize=function(){var t=this.canvas.offsetWidth,e=this.canvas.offsetHeight;this.width=this.minWidth>t?this.minWidth:t>this.maxWidth?this.maxWidth:t,this.height=this.minHeight>e?this.minHeight:e>this.maxHeight?this.maxHeight:e,this.scaleX=this.canvas.offsetWidth/this.width,this.scaleY=this.canvas.offsetHeight/this.height,this.scaleMode&&this.scaleX!=this.scaleY&&(this.scaleMode==dream.Screen.ScaleMode.SHOW_ALL?this.scaleX<this.scaleY?this.height=this.canvas.offsetHeight/this.scaleX:this.width=this.canvas.offsetWidth/this.scaleY:this.scaleX>this.scaleY?this.height=this.canvas.offsetHeight/this.scaleX:this.width=this.canvas.offsetWidth/this.scaleY,this.scaleX=this.canvas.offsetWidth/this.width,this.scaleY=this.canvas.offsetHeight/this.height),this.canvas.width=this.rect.width=this.width=0|this.width,this.canvas.height=this.rect.height=this.height=0|this.height,this.rect.transformation.x=this.scaleX,this.rect.transformation.y=this.scaleY,this.scenes.current&&(this.scenes.current.screenBoundary.width=this.width,this.scenes.current.screenBoundary.height=this.height,dream.event.dispatch(this.scenes.current,"onResize")),this.redrawRegions.add(new dream.Rect(0,0,screen.width,screen.height)),dream.event.dispatch(this,"onResize")},dream.Screen.prototype.highlight=function(t){this.context.strokeStyle="#f00",this.context.strokeRect(t.left,t.top,t.width,t.height)},Object.defineProperty(dream.Screen.prototype,"frameRate",{get:function(){return this._frameRate},set:function(t){this.requestAnimationFrameFunction=dream.util.getRequestAnimationFrame(t),this.cancelRequestAnimationFrameFunction=dream.util.getCancelRequestAnimationFrame(t),this._frameRate=t}}),dream.Screen.ScaleMode={EXACT_FIT:0,SHOW_ALL:1,NO_BORDER:2},dream.audio={},dream.audio.Sound=function(){},dream.audio.Music=function(){},function(){var t=function(){}.inherits(Array),e=t.prototype;dream.event.create(e,"onAdd"),dream.event.create(e,"onRemove"),e.indexOf=function(t){for(var e=0,i=this.length-1;e++!=i;)if(this[e]==t)return e},e.addArray=function(t){if(t)for(var e=0;t.length>e;e++)this.add(t[e],"item"+e)};var i=function(t){if(t)for(var e=0;t.length>e;e++)this.push(t[e])}.inherits(t),e=i.prototype;e.add=function(t){return this.push(t),dream.event.dispatch(this,"onAdd",t),t},e.pop=function(){var t=this[this.length-1];return this.length--,dream.event.dispatch(this,"onRemove",t),t},e.shift=function(){var t=this[0];return dream.event.dispatch(this,"onRemove",t),t},e.at=function(t){return this[t]},e.insert=function(t,e){return this.splice(t,0,e),dream.event.dispatch(this,"onAdd",e),e},e.removeByIndex=function(t){var e=this.splice(t,1)[0];return dream.event.dispatch(this,"onRemove",e),e},e.put=function(t,e){var i=this[t];return this[t]=e,i&&dream.event.dispatch(this,"onRemove",oldobj),dream.event.dispatch(this,"onAdd",e),e},e.remove=function(t){for(var e=0;this.length>e;e++)if(this[e]==t)return this.removeByIndex(e)},e.clear=function(){for(var t=0,e=this.length;e>t;t++)dream.event.dispatch(this,"onRemove",this[t]);this.length=0};var n=function(){this._GIDs={}}.inherits(i),e=n.prototype;e.add=function(t){var e=dream.util.getId(t);return this._GIDs[e]?t:(this._GIDs[e]=!0,this.push(t),dream.event.dispatch(this,"onAdd",t),t)},e.removeByIndex=function(t){return delete this._GIDs[dream.util.getId(this[t])],i.prototype.removeByIndex.call(this,t)};var r=function(){this.keys=[]}.inherits(t),e=r.prototype;e.add=function(t,e){var e=e||t.id||"id"+dream.util.getId(t);return this[e]=t,this.keys.push(e),this.push(t),dream.event.dispatch(this,"onAdd",t),t},e.addJson=function(t){if(t)for(var e in t)this.add(t[e],e)},e.removeById=function(t){for(var e=0;this.keys.length>e;e++)if(this.keys[e]==t)return this.removeByIndex(e)},e.removeByIndex=function(t){if(0>t||t>this.length-1)throw Error("index out of range");var e=this[t];if(t!=this.length-1){var i=this.pop(),n=this.keys.pop();delete this[this.keys[t]],this[t]=i,this.keys[t]=n}else this.splice(t,1),this.keys.splice(t,1);dream.event.dispatch(this,"onRemove",e)},e.remove=function(t){var e=this.indexOf(t);if(-1!=e)return this.removeByIndex(e);throw Error("object is not in dictionary")},e.clear=function(){for(var t=0;this[0];t++)this.removeByIndex(0)};var s=function(){this._current=null}.inherits(r),e=s.prototype;dream.event.create(e,"onSelect"),dream.event.create(e,"onDeselect"),e.select=function(t){this._current&&dream.event.dispatch(this,"onDeselect",this._current),this._current=t,dream.event.dispatch(this,"onSelect",t)},e.selectById=function(t){var e;(e=this[t])&&this.select(e)},Object.defineProperty(e,"current",{get:function(){return this._current},set:function(t){this.select(t)}});var o=function(){this.length=0,this.first=this.last=null},e=o.prototype;dream.event.create(e,"onAdd"),dream.event.create(e,"onRemove"),e.push=function(t){if(t.hasOwnProperty("previous")||t.hasOwnProperty("next"))throw Error("can't add object with next and previous attributes, may be duplicate!");this.first||(this.first=t),t.previous=this.last,t.previous&&(t.previous.next=t),t.next=null,this.last=t,this.length++,dream.event.dispatch(this,"onAdd",t)},e.pop=function(){var t=this.last;return this.last=t.previous,this.last.next=null,this.length--,0==this.length&&(this.first=null),dream.event.dispatch(this,"onRemove",t),t},e.shift=function(){var t=this.first;return t?(this.first=t.next,t.next.previous=void 0,dream.event.dispatch(this,"onRemove",t),this.length--,t):void 0},e.unshift=function(t){var e=this.first;e||this.push(t),this.addAt(t,0)},e.at=function(t){if(0>t||t>=this.length)throw Error("index out of Linklist range:  "+t);for(var e=this.first,i=0;t>i;i++)e=e.next;return e},e.indexOf=function(t){for(var e=0,i=this.first;this.length>e;e++,i=i.next)if(i==t)return e;return-1},e.add=e.push,e.insertAt=function(t,e){var i=this.at(t);this.insertBefore(i,e)},e.insertAfter=function(t,e){t.next?this.insertBefore(t.next,e):(this.last=e,e.previous=t,t.next=e,this.length++,dream.event.dispatch(this,"onAdd",e))},e.insertBefore=function(t,e){if(e.hasOwnProperty("previous")||e.hasOwnProperty("next"))throw Error("can't add object with next and previous attributes, may be duplicate!");t.previous?(t.previous.next=e,e.previous=t.previous):this.first=e,e.next=t,t.previous=e,this.length++,dream.event.dispatch(this,"onAdd",e)},e.remove=function(t){t.previous&&t.previous?(t.previous.next=t.next,t.next.previous=t.previous):!t.next&&t.previous?(this.last=t.previous,this.previous.next=null):!t.previous&&t.next&&(this.first=t.next,t.next.previous=null),delete t.previous,delete t.next,this.length--,dream.event.dispatch(this,"onRemove",t)},e.removeByIndex=function(t){var e=this.at(t);this.remove(e)},dream.collection={List:i,Linkedlist:o,Set:n,Dict:r,Selector:s}}(),function(){Function.prototype.inherits=function(t){return this.prototype=new t,this._superClass=t,this.prototype.constructor=this,this}}(),window.URL=window.URL||window.webkitURL,window.performance&&(window.performance.now=window.performance.now||window.performance.webkitNow()),window.dream||(dream={}),dream.fc=0,dream.DEBUG=!1,dream.hiwc=0,dream.Asset=function(){this.requiredResources=[]},dream.Asset.prototype.destroy=function(){},dream.VisualAsset=function(){}.inherits(dream.Asset),dream.event.createWithCapture(dream.VisualAsset.prototype,"onMouseEnter"),dream.event.createWithCapture(dream.VisualAsset.prototype,"onMouseLeave"),dream.event.createWithCapture(dream.VisualAsset.prototype,"onMouseMove"),dream.event.createWithCapture(dream.VisualAsset.prototype,"onMouseDown"),dream.event.createWithCapture(dream.VisualAsset.prototype,"onMouseUp"),dream.event.createWithCapture(dream.VisualAsset.prototype,"onClick"),dream.event.createWithCapture(dream.VisualAsset.prototype,"onDrag"),dream.event.createWithCapture(dream.VisualAsset.prototype,"onDragStart"),dream.event.createWithCapture(dream.VisualAsset.prototype,"onDragStop"),dream.event.createWithCapture(dream.VisualAsset.prototype,"onDrop"),dream.VisualAsset.prototype.raiseMouseDown=function(t){if(dream.event.dispatch(this,"onMouseDown$capture",t),t._isPropagationStopped)return!1;if(this.hovered){if(this.hovered.raiseMouseDown(t.toLocal(this.hovered)),t._isPropagationStopped)return!1;t.restore()}dream.event.dispatch(this,"onMouseDown",t),this.isMouseDown=!0},dream.VisualAsset.prototype.raiseMouseUp=function(t,e,i){return t._isPropagationStopped&&e._isPropagationStopped?!1:(t._isPropagationStopped||dream.event.dispatch(this,"onMouseUp$capture",t),this.isMouseDown&&!e._isPropagationStopped&&dream.event.dispatch(this,"onClick$capture",t),i&&!i._isPropagationStopped&&dream.event.dispatch(this,"onDrop$capture",i),this.hovered&&(this.hovered.raiseMouseUp(t.toLocal(this.hovered),e.toLocal(this.hovered),i&&i.toLocal(this.hovered)),t.restore(),e.restore()),i&&!i._isPropagationStopped&&dream.event.dispatch(this,"onDrop",i),t._isPropagationStopped||dream.event.dispatch(this,"onMouseUp",t),this.isMouseDown&&!e._isPropagationStopped&&(dream.event.dispatch(this,"onClick",t),this.isMouseDown=!1),void 0)},dream.VisualAsset.prototype.raiseMouseMove=function(t,e){dream.event.dispatch(this,"onMouseMove$capture",t),this.isMouseDown&&!this.isDragging&&dream.event.dispatch(this,"onDragStart$capture",e),this.hovered&&(this.hovered.raiseMouseMove(t.toLocal(this.hovered),e.toLocal(this.hovered)),t.restore(),e.restore()),t._isPropagationStopped||dream.event.dispatch(this,"onMouseMove",t),this.isMouseDown&&!this.isDragging&&(e._isPropagationStopped||dream.event.dispatch(this,"onDragStart",t),e._isDefaultPrevented||(this.isDragging=!0,this.hovered&&(this.dragging=this.hovered)))},dream.VisualAsset.prototype.raiseMouseLeave=function(t){this.hovered&&(this.hovered.raiseMouseLeave(t.toLocal(this.hovered)),t.restore()),this.isHovered=!1,this.hovered=null,dream.event.dispatch(this,"onMouseLeave",t)},dream.VisualAsset.prototype.raiseDrag=function(t){dream.event.dispatch(this,"onDrag$capture",t),t._isPropagationStopped||(this.dragging&&(this.dragging.raiseDrag(t.toLocal(this.dragging)),t.restore()),t._isPropagationStopped||dream.event.dispatch(this,"onDrag",t))},dream.VisualAsset.prototype.raiseDragStop=function(t){dream.event.dispatch(this,"onDragStop$capture",t),this.dragging&&!t._isPropagationStopped&&(this.dragging.raiseDragStop(t.toLocal(this.dragging)),t.restore()),this.dragging=!1,this.isDragging=!1,t._isPropagationStopped||dream.event.dispatch(this,"onDragStop",t)},dream.Point=function(t,e){this.left=t||0,this.top=e||0},dream.event.create(dream.Point.prototype,"onChange",function(){this._left=this.left,this._top=this.top,dream.util.createEventProperty(this,"left"),dream.util.createEventProperty(this,"top")}),dream.Point.prototype.toString=function(){return"Point["+this.left+", "+this.top+"]"},dream.Point.prototype.isIn=function(t){return this.left>=t.left&&this.left<=t.right&&this.top>=t.top&&this.top<=t.bottom},dream.Point.prototype.clone=function(){return new dream.Point(this.left,this.top)},dream.Rect=function(t,e,i,n,r){this.width=i||0,this.height=n||0,this.left=t||0,this.top=e||0,this.transformation=r||new dream.transform.Identity},Object.defineProperty(dream.Rect.prototype,"right",{get:function(){return this.left+this.width}}),Object.defineProperty(dream.Rect.prototype,"bottom",{get:function(){return this.top+this.height}}),Object.defineProperty(dream.Rect.prototype,"boundary",{get:function(){if(!this.transformation||this.transformation instanceof dream.transform.Identity)return this.clone();for(var t=this.transformation.matrix,e=this.left,i=this.right,n=this.top,r=this.bottom,s=[t.multiplyByPoint(new dream.Point(e,n)),t.multiplyByPoint(new dream.Point(i,n)),t.multiplyByPoint(new dream.Point(e,r)),t.multiplyByPoint(new dream.Point(i,r))],o=s[0].clone(),a=s[0].clone(),h=0;4>h;h++)s[h].left<o.left&&(o.left=s[h].left),s[h].left>a.left&&(a.left=s[h].left),s[h].top<o.top&&(o.top=s[h].top),s[h].top>a.top&&(a.top=s[h].top);return new dream.Rect(o.left,o.top,a.left-o.left,a.top-o.top)}}),dream.Rect.prototype.hasIntersectWith=function(t){return this.right>t.left&&this.left<t.right&&this.bottom>t.top&&this.top<t.bottom},dream.Rect.prototype.getIntersectWith=function(t){if(this.hasIntersectWith(t)){var e=Math.max(t.left,this.left),i=Math.max(t.top,this.top),n=Math.min(t.right,this.right),r=Math.min(t.bottom,this.bottom);return new dream.Rect(e,i,n-e+1,r-i+1)}return!1},dream.Rect.prototype.covers=function(t){return this.left<=t.left&&this.right>=t.right&&this.top<=t.top&&this.bottom>=t.bottom},dream.Rect.prototype.isEqualWith=function(t){return this.left==t.left&&this.width==t.width&&this.top==t.top&&this.height==t.height},dream.Rect.prototype.add=function(t){var e=new dream.Rect(this.left<t.left?this.left:t.left,this.top<t.top?this.top:t.top);return e.width=(this.right>t.right?this.right:t.right)-e.left,e.height=(this.bottom>t.bottom?this.bottom:t.bottom)-e.top,e.transformation=this.transformation,e},dream.Rect.prototype.clone=function(){return new dream.Rect(this.left,this.top,this.width,this.height)},dream.Rect.prototype.toString=function(){return"Rect["+this.left+", "+this.top+", "+this.width+", "+this.height+"]"},function(){var Action=function(t,e){this.fn=t,this.execOnSeek=e},Dynamic=function(t,e){t&&(this.fn=t),this.isPlaying=!1,this.isPassive=!1,this.interval=e||1},$=Dynamic.prototype;$.step=function(){this.fn.call(this.host)},$.init=function(t){return this.host=t,this},$.pause=function(){return this.isPlaying=!1,this},$.play=function(){return this.isPlaying=!0,this};var Animation=function(t,e,i){Dynamic.call(this,null,i),this.duration=t||1,1>this.duration&&(this.duration=1),this.loop=e,this.isBackward=!1,this.actions=new dream.collection.List,this._counter=0;var n=this;this.actions.onAdd.add(function(){n.isPassive=!1})}.inherits(Dynamic),$=Animation.prototype;dream.event.create($,"onEnd"),dream.event.create($,"onCycle"),dream.event.create($,"onPlay"),dream.event.create($,"onPause"),$.pause=function(){return this.isPlaying=!1,dream.event.dispatch("onPause"),this},$.play=function(){return(0==this._counter||this._counter==this.duration+1)&&this.rewind(),this.isPlaying=!0,dream.event.dispatch("onPlay"),this},$.rewind=function(){return this.seeker=this.isBackward?this.duration:1,this},$.stop=function(){return this.rewind(),this.pause(),this},Object.defineProperty($,"seeker",{get:function(){return this._counter},set:function(t){if(t!=this._counter){if(t>this.duration?t=this.duration:1>t&&(t=1),this.actions){var e,i,n;this._counter>t?(e=t,i=this._counter,n=!1):(e=this._counter,i=t,n=!0);var r;if(n)for(var s=e;i>=s;s++)if(r=this.actions[s])r.execOnSeek&&r.fn.call(this.host,1);else for(var s=i;e>=s;s--)(r=this.actions[s])&&r.execOnSeek&&r.fn.call(this.host,-1)}if(this.animations)for(var o,s=0;o=this.animations[s];s++)o.seeker=t-o._startFrame;this.step(t)}}}),Object.defineProperty($,"position",{get:function(){return this._counter}}),$.step=function(t){this.isBackward?(this._counter=void 0!=t?t:this._counter-1,1>this._counter&&(this.loop?(this.seeker=this.duration,dream.event.dispatch(this,"onCycle")):(this._isInTimeline||(this.isPlaying=!1),this._counter=0,dream.event.dispatch(this,"onEnd")))):(this._counter=void 0!=t?t:this._counter+1,this._counter>this.duration&&(this.loop?(this.seeker=1,dream.event.dispatch(this,"onCycle")):(this._isInTimeline||(this.isPlaying=!1),this._counter=this.duration+1,dream.event.dispatch(this,"onEnd"))));var e;(e=this.actions[this._counter])&&e.fn.call(this.host,this.isBackward?-1:1)};var Tween=function(t,e,i,n,r){Animation.call(this,i,n,r),this.valueMap=t,this.interpolator=e&&e.fn||dream.dynamic.interpolator.Linear.prototype.fn,"left"in t||"top"in t||"right"in t||"bottom"in t||"rotation"in t||(this.isPassive=!0)}.inherits(Animation),$=Tween.prototype;$.getHostValue=function(i){return i.indexOf(".")>-1?eval("this.host."+i):this.host[i]},$.setHostValue=function(i,v){return i.indexOf(".")>-1?eval("this.host."+i+" = "+v):this.host[i]=v},$.init=function(t){t&&(this.host=t),this.diffMap={},this.initialMap={};for(var e in this.valueMap){if("$"==e[0]){var i=e;e=e.slice(1),this.diffMap[e]=this.valueMap[i]}else this.diffMap[e]=this.valueMap[e]-this.getHostValue(e);this.initialMap[e]=this.getHostValue(e)}return this},$.step=function(t){Animation.prototype.step.call(this,t);var e=this.interpolator((this._counter-1)/this.duration);for(var i in this.diffMap)this.setHostValue(i,this.initialMap[i]+this.diffMap[i]*e)};var PathTween=function(t,e,i,n,r,s,o,a){if(Animation.call(this,s,o,a),!(t instanceof dream.geometry.Path))throw Error("PathTween Only Accepts a path as first argument");this.path=t,this.transform=e||new dream.transform.Identity,this.start=i||0,this.end=n||1,this.interpolator=r&&r.fn||dream.dynamic.interpolator.Linear.prototype.fn}.inherits(Animation),$=PathTween.prototype;$.init=function(t){this.host=t},$.step=function(t){Animation.prototype.step.call(this,t);var e,i,n;i=(this._counter-1)/this.duration+this.start,i>this.end&&(this.seeker=1),n=this.interpolator(i),n>1?n=1:0>n&&(n=0),e=this.transform.project(this.path.solve(n)),this.host.left=e.left,this.host.top=e.top};var Timeline=function(t,e,i){Timeline._superClass.call(this,t,e,i),this.isPassvie=!0,this.animations=new dream.collection.List;var n=this;this.animations.onAdd.add(function(t){dream.util.assert(t instanceof dream.dynamic.Animation,"you can only add animations to timeline"),t.isPlaying=!0,t._isInTimeline=!0,t.isPassive||(n.isPassive=!1)})}.inherits(Animation),$=Timeline.prototype;$.addAt=function(t,e,i){e._startFrame=t,this.animations.add(e,i)},$.init=function(t){this.host=t;for(var e,i=0;e=this.animations[i];i++)e.init(t)},$.step=function(t){Animation.prototype.step.call(this,t);for(var e,i,n=0;i=this.animations[n];n++)i.isPlaying&&i._startFrame<=this._counter&&i._startFrame+i.duration*i.interval>=this._counter&&(e=this._counter-i._startFrame,0==e%i.interval)&&i.step(e/i.interval)};var SpriteAnimation=function(t,e,i){SpriteAnimation._superClass.call(this,t.length,e,i),this.isPassive=!0,this.frames=new dream.collection.List,this.frames.addArray(t)}.inherits(Animation),$=SpriteAnimation.prototype;$.step=function(t){Animation.prototype.step.call(this,t),this.host.texture=this.frames[this._counter-1]},$.gotoFrame=function(t,e){for(var i,n=0;i=this.frames[n];n++)i.name==t&&(this.seek(n),e&&this.pause())};var DynamicList=function(t){DynamicList._superClass.call(this),this.isPlaying=!0,this._counter=0,this.host=t,this.onAdd.add(function(t){t.init(this.host)})}.inherits(dream.collection.Dict),$=DynamicList.prototype;$.step=function(){var t,e=this.length;if(this.host.isPresent)for(;t=this[--e];)t.isPlaying&&0==++this._counter%t.interval&&t.step();else for(;t=this[--e];)!t.isPassive&&t.isPlaying&&0==++this._counter%t.interval&&t.step()},$.pause=function(){this.isPlaying=!1},$.play=function(){this.isPlaying=!0};var Interpolator=function(){},Linear=function(){}.inherits(Interpolator);Linear.prototype.fn=function(t){return t};var Sine=function(t){var e=void 0==t?1:t;this.fn=function(t){var i=Math.PI;return Math.sin(2*i*t*e)}}.inherits(Interpolator),HalfSine=function(t){var e=void 0==t?1:t;this.fn=function(t){var i=Math.PI;return Math.abs(Math.sin(2*i*t*e))}}.inherits(Interpolator),Cosine=function(t){var e=void 0==t?1:t;this.fn=function(t){var i=Math.PI;return Math.cos(2*i*t*e)}}.inherits(Interpolator),Exp=function(t){var t=t||1;this.fn=function(e){return Math.exp(e,t)-1}}.inherits(Interpolator),PowerIn=function(t){var t=t||1;this.fn=function(e){return Math.pow(e,t)}}.inherits(Interpolator),PowerOut=function(t){var t=t||1;this.fn=function(e){return 1-Math.pow(1-e,t)}}.inherits(Interpolator),PowerInOut=function(t){var t=t||1;this.fn=function(e){return 1>(e*=2)?.5*Math.pow(e,t):1-.5*Math.abs(Math.pow(2-e,t))}},bounceoutfn=function(t){return 1/2.75>t?7.5625*t*t:2/2.75>t?7.5625*(t-=1.5/2.75)*t+.75:2.5/2.75>t?7.5625*(t-=2.25/2.75)*t+.9375:7.5625*(t-=2.625/2.75)*t+.984375},baouneinfn=function(t){return 1-bounceoutfn(1-t)},BounceOut=function(){this.fn=bounceoutfn}.inherits(Interpolator),BounceIn=function(){this.fn=baouneinfn}.inherits(Interpolator),BounceInOut=function(){this.fn=function(t){return.5>t?.5*baouneinfn(2*t):.5*bounceoutfn(2*t-1)+.5}}.inherits(Interpolator),BackIn=function(t){var t=t||1;this.fn=function(e){return e*e*((t+1)*e-t)}}.inherits(Interpolator),BackOut=function(t){var t=t||1;this.fn=function(e){return--e*e*((t+1)*e+t)+1}}.inherits(Interpolator),CircIn=function(){this.fn=function(t){return Math.sqrt(1- --t*t)}}.inherits(Interpolator),CircOut=function(){this.fn=function(t){return 1>(t*=2)?-.5*(Math.sqrt(1-t*t)-1):.5*(Math.sqrt(1-(t-=2)*t)+1)}}.inherits(Interpolator),ElasticIn=function(t,e){var i=2*Math.PI,n=void 0==t?1:t,r=void 0==e?.3:e;this.fn=function(t){if(0==t||1==t)return t;var e=r/i*Math.asin(1/n);return n*Math.pow(2,-10*t)*Math.sin((t-e)*i/r)+1}}.inherits(Interpolator),ElasticOut=function(t,e){var i=2*Math.PI,n=void 0==t?1:t,r=void 0==e?.3:e;this.fn=function(t){if(0==t||1==t)return t;var e=r/i*Math.asin(1/n);return-(n*Math.pow(2,10*(t-=1))*Math.sin((t-e)*i/r))}}.inherits(Interpolator),ElasticInOut=function(t,e){var i=2*Math.PI,n=void 0==t?1:t,r=void 0==e?.3:e;this.fn=function(t){var e=r/i*Math.asin(1/n);return 1>(t*=2)?-.5*n*Math.pow(2,10*(t-=1))*Math.sin((t-e)*i/r):.5*n*Math.pow(2,-10*(t-=1))*Math.sin((t-e)*i/r)+1}}.inherits(Interpolator),PathY=function(t,e){if(!(t instanceof dream.geometry.Path))throw Error("Path Interpolator Only Accepts a path as Input");this.path=t,this.scale=e||1;var i=this;this.fn=function(t){return point=i.path.solve(t).top/this.scale}}.inherits(Interpolator),PathX=function(t,e){if(!(t instanceof dream.geometry.Path))throw Error("Path Interpolator Only Accepts a path as Input");this.path=t,this.scale=e||1;var i=this;this.fn=function(t){return point=i.path.solve(t).left/this.scale}}.inherits(Interpolator);dream.dynamic={Action:Action,Dynamic:Dynamic,Animation:Animation,Tween:Tween,PathTween:PathTween,SpriteAnimation:SpriteAnimation,DynamicList:DynamicList,Interpolator:Interpolator,Timeline:Timeline,interpolator:{Linear:Linear,Sine:Sine,Cosine:Cosine,HalfSine:HalfSine,Exp:Exp,PowerIn:PowerIn,PowerOut:PowerOut,PowerInOut:PowerInOut,BounceIn:BounceIn,BounceOut:BounceOut,BounceInOut:BounceInOut,BackIn:BackIn,BackOut:BackOut,CircIn:CircIn,CircOut:CircOut,ElasticIn:ElasticIn,ElasticOut:ElasticOut,ElasticInOut:ElasticInOut,PathY:PathY,PathX:PathX}}}(),window.dream||(dream={}),dream.event={},dream.event.create=function(t,e,i){Object.defineProperty(t,e,{configurable:!0,get:function(){this.hasOwnProperty("__events")||(this.__events={});var t=this.__events[e]=new dream.util.EventDispatcher(this,e);return Object.defineProperty(this,e,{value:t}),i&&i.call(this),t}})},dream.event.createWithCapture=function(t,e,i,n){dream.event.create(t,e,i),dream.event.create(t,e+"$capture",n)},dream.event.dispatch=function(t,e){var i;t.__events&&(i=t.__events[e])&&i.dispatch.apply(i,Array.prototype.splice.call(arguments,2))},dream.event.UIEvent=function(){},function(){var t=function(t,e){return Error("Invalid SVG Path '"+t+"', Argument count mismatch! At Command:  "+e+".")},e=function(t,e){var i="_"+e;Object.defineProperty(t,e,{get:function(){return this[i]},set:function(e){var n=this;this[i]&&this[i].onChange.removeByOwner(t),this[i]=e,this[i].onChange.add(function(){n.updateLength(),dream.event.dispatch(n,"onChange")}),this.updateLength(),dream.event.dispatch(this,"onChange")}})},i=function(t){var e=this;this.segments=new dream.collection.Linkedlist,this.segments.onAdd.add(function(t){t.onChange.add(function(){e.updateLength(),dream.event.dispatch(e,"onChange")}),dream.event.dispatch(e,"onChange")}),this.segments.onRemove.add(function(t){e.length-=t.length,t.onChange.removeByOwner(e),dream.event.dispatch(e,"onChange")}),this.length=0,this.rect=new dream.Rect,t&&(this.parse(t),this.updateLength())},n=i.prototype;dream.event.create(n,"onChange"),n.draw=function(t,e){t.beginPath();for(var i=this.segments.first;i;)i.draw(t,e),i=i.next},n.updateLength=function(){for(var t=0,e=this.segments.first;e;)t+=e.length,this.rect=this.rect.add(e.rect),e=e.next;return this.length=t,t},n.solve=function(t){if(t>1)throw Error("'t' should be between 0 and 1 for solving a Path!");if(1==t)return this.segments.last.solve(1);for(var e,i=this.segments.first,n=0,r=this.length*t;r>n+i.length;)n+=i.length,i=i.next;return e=(r-n)/i.length,i.solve(e)},n.parse=function(e){for(var i,n,r=e.replace(/,/g," ").split(/([a-zA-Z])([\-0-9,\s]+)/).map(function(t){return""!=t?/^[a-zA-Z]{1}$/.test(t)?t:t.trim().split(/\s+/g):void 0}),p=0,l=0;r.length;)if(i=r.shift()){n=i.toLowerCase(),args=r.shift(),isRel=n==i;var f=!1;switch(n){case"m":f=a;case"l":if(f||(f=s),2>args.length)throw t(e,i);var m=+args.shift(),v=+args.shift();isRel&&(m+=p,v+=l),p=m,l=v,this.segments.push(new f(m,v));break;case"z":args=[];var g=new o(0,0);this.segments.push(g),g.init();break;case"c":if(6>args.length)throw t(e,i);var y=+args.shift(),w=+args.shift(),_=+args.shift(),P=+args.shift(),m=+args.shift(),v=+args.shift();isRel&&(m+=p,v+=l,y+=p,w+=l,_+=p,P+=l),p=m,l=v,this.segments.push(new h(y,w,_,P,m,v));break;case"s":if(4>args.length)throw t(e,i);var y=+args.shift(),w=+args.shift(),m=+args.shift(),v=+args.shift();isRel&&(m+=p,v+=l,y+=p,w+=l),p=m,l=v,this.segments.push(new d(y,w,m,v));break;case"q":if(4>args.length)throw t(e,i);var y=+args.shift(),w=+args.shift(),m=+args.shift(),v=+args.shift();isRel&&(m+=p,v+=l,y+=p,w+=l),p=m,l=v,this.segments.push(new c(y,w,m,v));break;case"t":if(2>args.length)throw t(e,i);var m=+args.shift(),v=+args.shift();isRel&&(m+=p,v+=l),p=m,l=v,this.segments.push(new u(m,v));break;default:throw Error("Invalid SVG Path '"+e+"', command is not defined! At Command:  "+i+".")}args.length&&(r.unshift(args),r.unshift(i))}};var r=function(t,e){(void 0!==t||void 0!==e)&&(this.dest=new dream.Point(t,e)),this.length=0,this.rect=new dream.Rect},n=r.prototype;dream.event.create(n,"onChange"),e(n,"dest"),Object.defineProperty(n,"previous",{get:function(){return this._previous},set:function(t){var e=this;this._previous&&this._previous.dest.onChange.removeByOwner(this),this._previous=t,this.updateLength(),dream.event.dispatch(e,"onChange"),this._previous&&this._previous.dest.onChange.add(function(){e.updateLength(),dream.event.dispatch(e,"onChange")})}}),n.getOrigin=function(t){var t=void 0==t?0:t;if(0>t||t>1)throw Error("t should be between 0-1 for solving a segment");return this.previous?this.previous.dest:new dream.Point},n.updateLength=function(t){var e,i,n,r,s,o,a,t=t||.02,h=0,d=0,c=0,u=this.getOrigin();s=r=u.left,o=a=u.top;for(var p=0;1>=p;p+=t)n=this.solve(p),n.left>r?r=n.left:s>n.left&&(s=n.left),n.top>o?o=n.top:a>n.top&&(a=n.top),e=n.left-h,i=n.top-d,h=n.left,d=n.top,c+=Math.sqrt(e*e+i*i);return this.length=c,this.rect.left=s,this.rect.top=a,this.rect.width=r-s,this.rect.height=o-a,c};var s=function(t,e){r.call(this,t,e)}.inherits(r),n=s.prototype;n.solve=function(t){var e=this.getOrigin(t);return new dream.Point((this.dest.left-e.left)*t+e.left,(this.dest.top-e.top)*t+e.top)},n.updateLength=function(){var t=this.getOrigin(),e=this.dest.left-t.left,i=this.dest.top-t.top,n=Math.sqrt(e*e+i*i);return e>0?(this.rect.left=t.left,this.rect.width=e):(this.rect.left=this.dest.left,this.rect.width=-1*e),i>0?(this.rect.top=t.top,this.rect.height=i):(this.rect.top=this.dest.top,this.rect.height=-1*i),this.length=n,n},n.draw=function(t){t.lineTo(this.dest.left,this.dest.top)};var o=function(t,e){s.call(this,t,e)}.inherits(s),n=o.prototype;n.getLastMove=function(){for(var t=this.previous;t;){if(t instanceof a)return t;t=t.previous}},n.init=function(){var t=this.getLastMove();t&&(this.dest=t.dest)};var a=function(t,e){r.call(this,t,e)}.inherits(r),n=a.prototype;n.updateLength=function(){return this.length=0},n.solve=function(t){var e=this.getOrigin(t);return new dream.Point(e.left,e.top)},n.draw=function(t){t.moveTo(this.dest.left,this.dest.top)},function(){}.inherits(r);var h=function(t,e,i,n,s,o){r.call(this,s,o),this.cp1=new dream.Point(t,e),this.cp2=new dream.Point(i,n)}.inherits(r),n=h.prototype;e(n,"cp1"),e(n,"cp2"),n.solve=function(t){if(!this.cp1||!this.cp2||!this.dest)return 0;var e=this.getOrigin(t),i=t*t,n=t*i,r=new dream.Point,s=e.left,o=this._cp1._left,a=this._cp2._left;
r.left=s+t*(3*-s+t*(3*s-s*t))+t*(3*o+t*(-6*o+3*o*t))+i*(3*a-3*a*t)+this.dest.left*n;var h=e.top,d=this._cp1._top,c=this._cp2._top;return r.top=h+t*(3*-h+t*(3*h-h*t))+t*(3*d+t*(-6*d+3*d*t))+i*(3*c-3*c*t)+this.dest.top*n,r},n.draw=function(t){t.bezierCurveTo(this.cp1.left,this.cp1.top,this.cp2.left,this.cp2.top,this.dest.left,this.dest.top)};var d=function(t,e,i,n){h.call(this,0,0,t,e,i,n)}.inherits(h),n=d.prototype;n._updateCp2=function(t){t.cp2?(this.cp1.left=2*t.dest.left-t.cp2.left,this.cp1.top=2*t.dest.top-t.cp2.top):(this.cp1.left=t.dest.left,this.cp1.top=t.dest.top)},Object.defineProperty(n,"previous",{get:function(){return this._previous},set:function(t){var e=this;this._previous&&this._previous.dest.onChange.removeByOwner(this),this._previous&&this._previous.cp2.onChange.removeByOwner(this),this._previous=t,this._updateCp2(t),this.updateLength(),dream.event.dispatch(e,"onChange"),this._previous.dest.onChange.add(function(){e._updateCp2(e._previous),e.updateLength(),dream.event.dispatch(e,"onChange")}),this._previous.cp2.onChange.add(function(){e._updateCp2(e._previous),e.updateLength(),dream.event.dispatch(e,"onChange")})}});var c=function(t,e,i,n){r.call(this,i,n),this.cp=new dream.Point(t,e)}.inherits(r),n=c.prototype;e(n,"cp"),n.solve=function(t){if(!this.cp||!this.dest)return 0;var e=this.getOrigin(t),i=1-t,n=new dream.Point;return n.left=i*i*e.left+2*i*t*this._cp._left+t*t*this.dest.left,n.top=i*i*e.top+2*i*t*this._cp._top+t*t*this.dest.top,n},n.draw=function(t){t.quadraticCurveTo(this.cp.left,this.cp.top,this.dest.left,this.dest.top)};var u=function(t,e){c.call(this,0,0,t,e)}.inherits(c),n=u.prototype;n._updateCp=function(t){t.cp?(this.cp.left=2*t.dest.left-t.cp.left,this.cp.top=2*t.dest.top-t.cp.top):(this.cp.left=t.dest.left,this.cp.top=t.dest.top)},Object.defineProperty(n,"previous",{get:function(){return this._previous},set:function(t){var e=this;this._previous&&this._previous.dest.onChange.removeByOwner(this),this._previous&&this._previous.cp.onChange.removeByOwner(this),this._previous=t,this._updateCp(t),this.updateLength(),dream.event.dispatch(e,"onChange"),this._previous.dest.onChange.add(function(){e._updateCp(e._previous),e.updateLength(),dream.event.dispatch(e,"onChange")}),this._previous.cp.onChange.add(function(){e._updateCp(e._previous),e.updateLength(),dream.event.dispatch(e,"onChange")})}}),dream.geometry={Path:i,pathSegment:{Move:a,Line:s,Zline:o,QuadraticBezier:c,CubicBezier:h,SmoothQuadraticBezier:u,SmoothCubicBezier:d}}}(),function(t){var e=function(){},i=e.prototype;i.stopPropagation=function(){this._isPropagationStopped=!0},i.preventDefault=function(){this._isDefaultPrevented=!0};var n=function(t,i,n){e.call(this),this.screenPosition=i||new dream.Point,this.position=this.screenPosition,this.local=n,this.domEvent=t,this._parentStack=[],this._localStack=[]}.inherits(e),i=n.prototype;i.toLocal=function(t){return this._localStack.push(this.local),this._parentStack.push(this.position),this.position=this.localPosition,this.local=t,this},i.restore=function(){return this.position=this._parentStack.pop(),this.local=this._localStack.pop(),this},Object.defineProperty(i,"localPosition",{get:function(){return this.local.rect.transformation.unproject(this.position)}}),Object.defineProperty(i,"buttons",{get:function(){return this.domEvent.buttons}}),Object.defineProperty(i,"ctrlKey",{get:function(){return this.domEvent.ctrlKey}}),Object.defineProperty(i,"shiftKey",{get:function(){return this.domEvent.shiftKey}}),Object.defineProperty(i,"altKey",{get:function(){return this.domEvent.altKey}}),Object.defineProperty(i,"metaKey",{get:function(){return this.domEvent.metaKey}});var r=function(e){this.mouse={position:new dream.Point,isDown:!1},this.screen=e,this.interval=1;var i=this;t.addEventListener("mousemove",function(r){var s=r.clientX,o=r.clientY;i.mouse.position.left=s-i.screen.canvas.offsetLeft+(t.scrollX||document.body.scrollLeft),i.mouse.position.top=o-i.screen.canvas.offsetTop+(t.scrollY||document.body.scrollTop),e.raiseMouseMove(new n(r,i.mouse.position,e),new n(r,i.mouse.position,e))},!1),e.canvas.addEventListener("mousedown",function(t){i.mouse.isDown=!0,e.raiseMouseDown(new n(t,i.mouse.position,e))},!1),e.canvas.addEventListener("mouseout",function(t){e.raiseMouseLeave(new n(t,i.mouse.position,e))},!1),e.canvas.addEventListener("mouseover",function(){e.isHovered=!0},!1),t.addEventListener("mouseup",function(t){i.mouse.isDown=!1,e.raiseMouseUp(new n(t,i.mouse.position,e),new n(t,i.mouse.position,e),e.isDragging?new n(t,i.mouse.position,e):!1),e.raiseDragStop(new n(t,i.mouse.position,e))},!1)},s={LEFT:37,TAB:9,UP:38,RIGHT:39,DOWN:40,ENTER:13,SHIFT:16,CTRL:17,ALT:18,PAUSE:19,ESC:27,SPACE:32,NUM0:48,NUM1:49,NUM2:50,NUM3:51,NUM4:52,NUM5:53,NUM6:54,NUM7:55,NUM8:56,NUM9:57,PLUS:107,MINUS:109,ASTERISK:106,SLASH:111,A:65,B:66,C:67,D:68,E:69,F:70,G:71,H:72,I:73,J:74,K:75,L:76,M:77,N:78,O:79,P:80,Q:81,R:82,S:83,T:84,U:85,V:86,W:87,X:88,Y:89,Z:90};dream.input={InputEvent:e,MouseEvent:n,InputHandler:r,Key:s},dream.event.create(dream.input,"onKeyDown"),dream.event.create(dream.input,"onKeyPress"),dream.event.create(dream.input,"onKeyUp"),dream.event.create(dream.input,"onWheel"),dream.event.create(dream.input,"onDeviceMotion"),t.addEventListener("keydown",function(t){dream.event.dispatch(dream.input,"onKeyDown",t)},!1),t.addEventListener("keypress",function(t){dream.event.dispatch(dream.input,"onKeyPress",t)},!1),t.addEventListener("keyup",function(t){dream.event.dispatch(dream.input,"onKeyUp",t)},!1),t.addEventListener(t.onwheel?"wheel":"mousewheel",function(t){dream.event.dispatch(dream.input,"onWheel",t)},!1),t.DeviceMotionEvent&&t.addEventListener("devicemotion",function(t){dream.event.dispatch(dream.input,"onDeviceMotion",t)},!1),Object.defineProperty(dream.input,"deviceOrientation",{get:function(){return t.orientation}})}(window),dream.net={},function(){var t=function(){this._area=new dream.Rect},e=t.prototype;e.init=function(t){this.pool=t},e.provide=function(){return null},Object.defineProperty(e,"area",{set:function(t){return this._area==t?t:(this._area=t,this.provide(t),void 0)},get:function(){return this._area}});var i=function(){t.call(this),this.assets=new dream.util.AssetLibrary;var e=this;this.assets.onAdd.add(function(t){t.boundary.hasIntersectWith(e._area)&&e.pool.add(t)}),this.assets.onRemove.add(function(t){this.pool.remove(t)})}.inherits(t),e=i.prototype;e.provide=function(t){for(var e,i=0;e=this.assets[i];i++)e.boundary.hasIntersectWith(t)&&this.pool.add(e)},Object.defineProperty(e,"requiredResources",{get:function(){return this.assets.requiredResources}}),dream.provider={Provider:t,OfflineProvider:i}}(window),dream.scenery={},dream.scenery.Scene=function(){dream.scenery.Scene._superClass.call(this);var t=this;this.screenBoundary=new dream.Rect,this.viewport=new dream.Rect,this.renderDistanceX=1,this.renderDistanceY=1,this.areaChangeRate=.5,this.loader=new dream.static.Loader,this.assets=new dream.util.AssetLibrary,this.assets.onAdd.add(function(e){e.__IS_PERSIST=!0,t.pool.add(e)}),this.assets.onRemove.add(this.pool.remove.bind(this.pool)),this.providers=new dream.collection.Dict,this.providers.onAdd.add(function(e){e.init(t.pool)}),this.pool.onAdd.add(function(e){t.addToRect(e),e.isImageChanged=!0,e.onBoundaryChange.add(function(){t.addToRect(this),t.checkPresence(this)},t),t._isDirty||e.onImageChange.add(function(e){t.redrawRegions.addArray(e)},t)}),this.pool.onRemove.add(function(e){e.onBoundaryChange.removeByOwner(t),e.onImageChange.removeByOwner(t),e.onZChange.removeByOwner(t),e.isPresent=!1,e.isPresent&&t.renderList[e.z].splice(t.renderList[e.z].indexOf(e),1)}),this.area=new dream.Rect,this.onResize.add(this.onBoundaryChange.add(function(){t.viewport=t.rect.transformation.unprojectRect(t.screenBoundary).boundary,0==t.viewport.width&&0==t.viewport.height&&this.pool.clear();var e=t.viewport.clone(),i=e.width,n=e.height;e.left-=e.width*t.renderDistanceX,e.top-=e.height*t.renderDistanceY,e.width+=2*e.width*t.renderDistanceX,e.height+=2*e.height*t.renderDistanceY;var r=t.area.getIntersectWith(e);if((e.width-r.width>i*t.renderDistanceX*t.areaChangeRate||e.height-r.height>n*t.renderDistanceY*t.areaChangeRate)&&(t.area=e,this.providers.length)){for(var s=0;t.pool.length>s;s++){var o=t.pool[s];o.__IS_PERSIST||o.boundary.hasIntersectWith(e)||(t.pool.removeByIndex(s),s--)}for(var a,s=0;a=t.providers[s];s++)a.area=e}for(var o,s=0;o=t.pool[s];s++)t.checkPresence(o)})),this.camera=new dream.scenery.Camera(this)}.inherits(dream.visual.Composite),dream.event.create(dream.scenery.Scene.prototype,"onResize"),dream.scenery.Scene.prototype.checkPresence=function(t){var e=this;if(!t.isPresent&&e.viewport.hasIntersectWith(t.boundary)){t.isPresent=!0;var i=t.z;(e.renderList[i]||(e.renderList[i]=[])).push(t),t.onZChange.add(function(t){var i=e.renderList[t];i.splice(i.indexOf(this),1),(e.renderList[this.z]||(e.renderList[this.z]=[])).push(this)},e)}else t.isPresent&&!e.viewport.hasIntersectWith(t.boundary)&&(t.isPresent=!1,e.renderList[t.z].splice(e.renderList[t.z].indexOf(t),1),t.onZChange.removeByOwner(e))},Object.defineProperty(dream.scenery.Scene.prototype,"requiredResources",{get:function(){for(var t=this.assets.requiredResources,e=0;this.providers.length>e;e++)t.addArray(this.providers[e].requiredResources);return t}}),dream.scenery.Scene.prototype.prepare=function(t){this.loader.isRequestSent&&this.loader.abort(),this.loader.resources=this.requiredResources,this.loader.load(t)},dream.scenery.Camera=function(t){this.scene=t}.inherits(dream.Rect),Object.defineProperty(dream.scenery.Camera.prototype,"left",{set:function(t){this.scene.anchorX=t},get:function(){return this.scene.anchorX}}),Object.defineProperty(dream.scenery.Camera.prototype,"top",{set:function(t){this.scene.anchorY=t},get:function(){return this.scene.anchorY}}),Object.defineProperty(dream.scenery.Camera.prototype,"width",{get:function(){return this.scene.width}}),Object.defineProperty(dream.scenery.Camera.prototype,"height",{get:function(){return this.scene.height}}),Object.defineProperty(dream.scenery.Camera.prototype,"scale",{set:function(t){this.scene.scale=t},get:function(){return this.scene.scale}}),Object.defineProperty(dream.scenery.Camera.prototype,"rotation",{set:function(t){this.scene.rotation=-1*t},get:function(){return-1*this.scene.rotation}}),function(t){var e={},i=function(t){var e=document.createElement("a");return e.href=t,e.href},n=function(t){this.loadedCount=0,this.resources=t||[],this.isRequestSent=!1},r=n.prototype;dream.event.create(r,"onLoad"),dream.event.create(r,"onProgress"),r.load=function(t){if(this.isRequestSent||0==this.resources.length)t.call(this);else{this.onLoad.addTemp(t),this.isRequestSent=!0,this.loadedCount=0;for(var e,i=this,n=0;e=this.resources[n];n++)e.load(function(){i.loadedCount++,dream.event.dispatch(i,"onProgress"),i.loadedCount==i.resources.length&&dream.event.dispatch(i,"onLoad")})}},r.reload=function(t){this.abort(),this.load(t)},r.abort=function(){this.isRequestSent=!1;for(var t,e=0;t=this.resources[e];e++)t.abort()};var s=function(t){if(this.content=null,this.loader=null,this.dependencies=[],this.isLoaded=!1,this.isRequestSent=!1,t){var n,r=t.split(";");return this.url=i(r[0]),this.forcedMimeType=(n=r[1]&&r[1].split(":"))&&"Content-Type"==n[0].trim()&&n[1].trim(),e[this.url]||(e[this.url]=-1==this.url.indexOf("#")?this:new Fragment(this.url))}},r=s.prototype;dream.event.create(r,"onLoad"),dream.event.create(r,"onSelfLoad"),dream.event.create(r,"onProgress"),r.load=function(t){this.isRequestSent?t&&t.call(this):(this.isRequestSent=!0,this.doLoad(t))},r.reload=function(t){this.abort(),this.load(t)},r.abort=function(){this.isRequestSent=!1,this.xhr&&(this.xhr.abort(),delete this.xhr,this.depLoader&&(this.depLoader.cancel(),delete this.depLoader));for(var t,e=0;t=this.dependencies[e];e++)t.abort()},r.doLoad=function(t){var e=this;t&&this.onLoad.addTemp(t);var i=this.xhr=new XMLHttpRequest;i.overrideMimeType&&this.forcedMimeType&&i.overrideMimeType(this.forcedMimeType),i.onprogress=function(t){dream.event.dispatch(e,"onProgress",t)},i.onreadystatechange=function(){if(this.readyState==this.HEADERS_RECEIVED){var t=e.forcedMimeType||this.getResponseHeader("Content-Type"),i=o.getResourceLoader(t);if(!i)throw Error("Cannot load resource with Content-Type '"+t+"'!");e.loader=new i(this,e.url,function(){if(e.content=e.loader.content,e.dependencies=e.loader.dependencies,e.isLoaded||dream.event.dispatch(e,"onSelfLoad"),this.dependencies&&this.dependencies.length>0){var t=this.depLoader=new n(this.dependencies);t.onLoad.add(function(){e.isLoaded=!0,dream.event.dispatch(e,"onLoad")}),t.load()}else e.isLoaded=!0,dream.event.dispatch(e,"onLoad")})}},i.open("GET",this.url,!0),i.send()},Fragment=function(t){Fragment._superClass.call(this);var e=t.split("#");this.resource=new s(e[0]),this.hash=e[1]}.inherits(s);var r=Fragment.prototype;r.doLoad=function(t){this.isLoaded=!0,dream.event.dispatch(this,"onSelfLoad");var e=this;this.resource.load(function(){e.content=this.loader.getContent(e.hash),t&&t.call(this)})},Object.defineProperty(r,"dependencies",{get:function(){return[this.resource]}});var o=function(t,e){this.content=null,this.url=e,this.dependencies=[]},r=o.prototype;r.getContent=function(){return this.content},o.loaders=[],o.register=function(t){o.loaders.push(t)},o.getResourceLoader=function(t){for(var e,i=o.loaders.length-1;e=o.loaders[i];i--)if(e.mimeType.exec(t))return e;return null},o.Type={TEXT:"text",BLOB:"blob",DOCUMENT:"document"};var a=function(t,e){a._superClass.call(this,t,e);try{t&&void 0!=t.responseType&&(t.responseType=o.Type.BLOB)}catch(i){console.log(i)}}.inherits(o),h=function(e,i,n){h._superClass.call(this,e,i);var r=this;if(e.responseType==o.Type.BLOB)e.onload=function(){var e=new Image;e.onload=function(){t.URL.revokeObjectURL(e.src),n()},e.src=t.URL.createObjectURL(this.response),r.content=e};else{e.abort();var s=new Image;s.onload=function(){r.content=s,n()},s.src=i}}.inherits(a);h.mimeType=/image\/(.+)/,o.register(h);var d=function(t,e,i){d._superClass.call(this,t,e),t&&(void 0!=t.responseType&&(t.responseType=o.Type.DOCUMENT),t.onload=function(){rl.content=this.responseType==o.Type.DOCUMENT?this.response:this.responseXML,i()})}.inherits(o);d.mimeType=/(text\/xml) | (application\/xml)/,o.register(d);var c=function(t,e,i){c._superClass.call(this,t,i)}.inherits(d);c.mimeType=/application\/tiled-map+xml/,Object.defineProperty(c.prototype,"dependencies",{get:function(){if(this.content){var t=[],e=/^(.*\/).*$/.exec(this.url);e=e?e[1]:"";for(var i,n=this.content.getElementsByTagName("image"),r=0;i=n[r];r++)t.push(new dream.static.ImageResource(e+i.getAttribute("source")));return t.length?t:null}return null}}),o.register(c),dream.static={Loader:n,Resource:s,ResourceLoader:o,BlobResourceLoader:a,ImageResourceLoader:h,DocumentResourceLoader:d,TiledMapResourceLoader:c,normalizeUrl:i,cache:e}}(window),function(){var t=function(t,e,i,n,r,s){this.x0=t,t||0===t||(this.x0=1),this.y0=e||0,this.x1=i||0,this.y1=n,n||0===n||(this.y1=1),this.dx=r||0,this.dy=s||0},e=t.prototype;e.multiplyBy=function(t){return new dream.transform.Matrix(this.x0*t.x0+this.y0*t.x1,this.x0*t.y0+this.y0*t.y1,this.x1*t.x0+this.y1*t.x1,this.x1*t.y0+this.y1*t.y1,this.x0*t.dx+this.x1*t.dy+this.dx,this.y0*t.dx+this.y1*t.dy+this.dy)},e.multiplyByPoint=function(t){return new dream.Point(this.x0*t.left+this.x1*t.top+this.dx,this.y0*t.left+this.y1*t.top+this.dy)},Object.defineProperty(e,"inverse",{get:function(){var e=this.x0,i=this.y0,n=this.x1,r=this.y1,s=this.dx,o=this.dy,a=e*r-i*n;return new t(r/a,-i/a,-n/a,e/a,(n*o-r*s)/a,-(e*o-i*s)/a)}});var i=function(){this.isChanged=!0},e=i.prototype;dream.event.create(e,"onChange"),dream.event.create(e,"onPositionChange"),Object.defineProperty(e,"matrix",{get:function(){return this.isChanged&&(this.updateMatrix(),this.isChanged=!1),this._matrix}}),Object.defineProperty(e,"inverse",{get:function(){var t=this.matrix.inverse;return new a(t.x0,t.y0,t.x1,t.y1,t.dx,t.dy)}}),e.hasTransform=!1,e.compose=function(t){var e=this.matrix.multiplyBy(t.matrix);return new a(e.x0,e.y0,e.x1,e.y1,e.dx,e.dy)},e.project=function(t){return this.matrix.multiplyByPoint(t)},e.projectRect=function(t){return new dream.Rect(t.left,t.top,t.width,t.height,this.compose(t.transformation))},e.unproject=function(t){return this.matrix.inverse.multiplyByPoint(t)},e.unprojectRect=function(t){return new dream.Rect(t.left,t.top,t.width,t.height,this.inverse.compose(t.transformation))},e.apply=function(t,e){return e};var n=function(){this._matrix=new t}.inherits(i),e=n.prototype;Object.defineProperty(e,"matrix",{get:function(){return this._matrix}});var r=function(t,e){r._superClass.call(this),this._left=t||0,this._top=e||0}.inherits(i),e=r.prototype;dream.util.createEventFlagProperty(e,"left","onPositionChange"),dream.util.createEventFlagProperty(e,"top","onPositionChange"),Object.defineProperty(e,"hasTransform",{get:function(){return this._left||this._top}}),e.updateMatrix=function(){this._matrix=new dream.transform.Matrix(1,0,0,1,this._left,this._top)},e.apply=function(t,e){return new dream.Point(0|e.left+this._left,0|e.top+this._top)};var s=function(t){s._superClass.call(this),this._angle=t*dream.transform.DEG_TO_RAD||0}.inherits(i),e=s.prototype;Object.defineProperty(e,"angle",{get:function(){return this._angle*dream.transform.RAD_TO_DEG},set:function(t){this._angle=this.hasTransform=t%360*dream.transform.DEG_TO_RAD,this.isChanged=!0,dream.event.dispatch(this,"onChange")}}),e.updateMatrix=function(){var t=this._angle,e=Math.cos(t),i=Math.sin(t);this._matrix=new dream.transform.Matrix(e,i,-i,e,0,0)},e.apply=function(t,e){var i=e.left,n=e.top;return(i||n)&&t.translate(i,n),t.rotate(this._angle),new dream.Point};var o=function(t,e){o._superClass.call(this),this._x=t,this._y=e,void 0==this._x&&(this._x=1),void 0==this._y&&(this._y=1)}.inherits(i),e=o.prototype;dream.util.createEventFlagProperty(e,"x"),dream.util.createEventFlagProperty(e,"y"),Object.defineProperty(e,"hasTransform",{get:function(){return 1!=this._x||1!=this._y}}),e.updateMatrix=function(){this._matrix=new dream.transform.Matrix(this._x,0,0,this._y,0,0)},e.apply=function(t,e){var i=e.left,n=e.top;return(i||n)&&t.translate(i,n),t.scale(this._x,this._y),new dream.Point};var a=function(t,e,i,n,r,s){a._superClass.call(this),this._x0=t,t||0===t||(this._x0=1),this._y0=e||0,this._x1=i||0,this._y1=n,n||0===n||(this._y1=1),this._dx=r||0,this._dy=s||0}.inherits(i),e=a.prototype;dream.util.createEventFlagProperty(e,"x0"),dream.util.createEventFlagProperty(e,"y0"),dream.util.createEventFlagProperty(e,"x1"),dream.util.createEventFlagProperty(e,"y1"),dream.util.createEventFlagProperty(e,"dx"),dream.util.createEventFlagProperty(e,"dy"),Object.defineProperty(e,"hasTransform",{get:function(){return 1!=this._x0||this._y0||this._x1||1!=this._y1||this._dx||this._dy}}),e.updateMatrix=function(){this._matrix=new t(this._x0,this._y0,this._x1,this._y1,this._dx,this._dy)},e.apply=function(t,e){var i=e.left,n=e.top;return(i||n)&&t.translate(i,n),t.transform(this._x0,this._y0,this._x1,this._y1,this._dx,this._dy),new dream.Point};var h=function(t){h._superClass.call(this);var e=this;this.transformations=new dream.collection.Dict,this.transformations.onAdd.add(function(t){t.onChange.propagate(e),t.onPositionChange.propagate(e),t.onChange.add(t.onPositionChange.add(function(){e.isChanged=!0})),dream.event.dispatch(e,"onChange"),e.isChanged=!0}),this.transformations.onRemove.add(function(t){t.onChange.removeByOwner(e),dream.event.dispatch(e,"onChange"),e.isChanged=!0}),this.transformations.addArray(t)}.inherits(i),e=h.prototype;Object.defineProperty(e,"hasTransform",{get:function(){for(var t,e=0;t=this.transformations[e];e++)if(t.hasTransform)return!0;return!1}}),e.updateMatrix=function(){for(var e,i=this.transformations[0],n=1;e=this.transformations[n];n++)e.hasTransform&&(i=i.compose(e));this._matrix=i&&i.matrix||new t},e.apply=function(t,e){for(var i,n=e,r=0;i=this.transformations[r];r++)i.hasTransform&&(n=i.apply(t,n));return n};var d=function(t,e,i,n,a,h,c){d._superClass.apply(this),this._ax=-h||0,this._ay=-c||0,this.transformations.add(new r(t,e),"translation"),this.transformations.add(new o(i,n),"scale"),this.transformations.add(new s(a),"rotation"),this.transformations.add(new r(-h,-c),"anchor")}.inherits(h),e=d.prototype;dream.util.createProperty(e,"left","transformations.translation.left"),dream.util.createProperty(e,"top","transformations.translation.top"),dream.util.createProperty(e,"scaleX","transformations.scale.x"),dream.util.createProperty(e,"scaleY","transformations.scale.y"),dream.util.createProperty(e,"rotation","transformations.rotation.angle"),Object.defineProperty(e,"anchorX",{get:function(){return-this.transformations.anchor.left},set:function(t){this.transformations.anchor.left=this._ax=-t}}),Object.defineProperty(e,"anchorY",{get:function(){return-this.transformations.anchor.top},set:function(t){this.transformations.anchor.top=this._ay=-t}}),e.apply=function(t,e){if(this.transformations.scale.hasTransform||this.transformations.rotation.hasTransform){var i=this.matrix;return t.transform(i.x0,i.y0,i.x1,i.y1,(0|i.dx)+e.left,(0|i.dy)+e.top),new dream.Point}return new dream.Point(0|e.left+this.transformations.translation.left+this._ax,0|e.top+this.transformations.translation.top+this._ay)},dream.transform={DEG_TO_RAD:Math.PI/180,RAD_TO_DEG:180/Math.PI,Matrix:t,Transformation:i,Identity:n,Translation:r,Rotation:s,Scale:o,Custom:a,Composite:h,Generic:d}}(),dream.util={},dream.util.ArrayList=function(t){this.keys={},this._index={},t&&this.addArray(t)}.inherits(Array),dream.event.create(dream.util.ArrayList.prototype,"onAdd"),dream.event.create(dream.util.ArrayList.prototype,"onRemove"),dream.util.ArrayList.prototype.add=function(t,e){var i=dream.util.getId(t);if(this._index[i])return t;var n=e||"id"+i;return void 0!=this.keys[n]&&(console.log(n+" replaced!"),this.remove(n)),this._index[i]=n,this.keys[n]=this.push(t)-1,this[n]=t,dream.event.dispatch(this,"onAdd",t),t},dream.util.ArrayList.prototype.indexOf=function(t){return t instanceof Object?this.keys[this._index[dream.util.getId(t)]]:this.keys[t]},dream.util.ArrayList.prototype.removeByIndex=function(t){dream.util.assert("number"==typeof t);var e=this.splice(t,1)[0];dream.util.assert(e);var i=dream.util.getId(e),n=this._index[i];delete this.keys[n],delete this._index[i],delete this[n];for(var r,s=t;r=this[s];s++)this.keys[this._index[dream.util.getId(r)]]--;return dream.event.dispatch(this,"onRemove",e),e},dream.util.ArrayList.prototype.remove=function(t){if("number"==typeof t)return this.removeByIndex(e);var e=this.indexOf(t);return"number"==typeof e?this.removeByIndex(e):!1},dream.util.ArrayList.prototype.replace=function(t,e,i){dream.util.assert(t),dream.util.assert(e);var n=dream.util.getId(t),r=dream.util.getId(e),s=i||"id"+r,o=this._index[n];delete this._index[n],this._index[r]=s;var a=this.keys[o];return this.keys[s]=a,delete this.keys[o],this[a]=e,dream.event.dispatch(this,"onRemove",t),dream.event.dispatch(this,"onAdd",e),e},dream.util.ArrayList.prototype.clear=function(){for(var t,e=0;t=this[e];e++)dream.event.dispatch(this,"onRemove",t),delete this[this._index[dream.util.getId(t)]],delete this[e];this.splice(0,this.length),this.keys=[],this._index=[]},dream.util.ArrayList.prototype.addArray=function(t){t&&t.forEach(this.add,this)},dream.util.ArrayList.prototype.addJson=function(t){for(var e in t)this.add(t[e],e)},dream.util.IndexedArrayList=function(t,e){this.indexes=t,this.index={};for(var i in this.indexes)this.index[i]={};dream.util.IndexedArrayList._superClass.call(this,e)}.inherits(dream.util.ArrayList),dream.util.IndexedArrayList.prototype.add=function(t,e){for(var i in this.indexes){var n=this.index[i][t[i]]||(this.index[i][t[i]]=[]);n.push(t);var r=this;this.indexes[i]&&t[this.indexes[i]].add(function(e){var n=r.index[i][e];n.splice(n.indexOf(t),1),n.length||delete r.index[i][e];var s=r.index[i][this[i]]||(r.index[i][this[i]]=[]);s.push(t)})}return dream.util.IndexedArrayList._superClass.prototype.add.call(this,t,e)},dream.util.Selector=function(t){dream.util.Selector._superClass.call(this,t)}.inherits(dream.util.ArrayList),dream.event.create(dream.util.Selector.prototype,"onDeselect"),dream.event.create(dream.util.Selector.prototype,"onSelect"),dream.util.Selector.prototype.selectObject=function(t,e){return this._current=t,this._currentIndex=e,dream.event.dispatch(this,"onSelect",t),t},dream.util.Selector.prototype.select=function(t){return"string"==typeof t?this.selectObject(this[t],this.indexOf(t)):"number"==typeof t?this.selectObject(this[t],t):this.selectObject(t,this.indexOf(t))},dream.util.Selector.prototype.next=function(t){var e=this._currentIndex+(t||1);this.select(e>=this.length?0:e)},dream.util.Selector.prototype.previous=function(t){var e=this._currentIndex-(t||1);this.select(0>e?this.length-1:e)},Object.defineProperty(dream.util.Selector.prototype,"current",{get:function(){return this._current},set:function(t){this.selectObject(t)}}),dream.util.EventDispatcher=function(t,e){dream.util.EventDispatcher._superClass.call(this),this.obj=t,this.name=e,this.listeners={}}.inherits(dream.collection.List),dream.util.EventDispatcher.prototype.add=function(t,e){var i=dream.util.EventDispatcher._superClass.prototype.add.call(this,t,"string"==typeof e?e:null);if(e){var n=dream.util.getId(e),r=this.listeners[n]||(this.listeners[n]=[]);r.push(this.length)}return 1==this.length?this.dispatch=this[0].bind(this.obj):delete this.dispatch,i},dream.util.EventDispatcher.prototype.addTemp=function(t,e){var i,n=this;this.add(i=function(){n.remove(i),t&&t.call(this)},e)},dream.util.EventDispatcher.prototype.removeByOwner=function(t){var e,i=dream.util.getId(t);if(e=this.listeners[i]){for(var n=0,r=e.length;r>n;n++)this.removeByIndex(n);delete this.listeners[i]}},dream.util.EventDispatcher.prototype.dispatch=function(){for(var t=this.obj,e=0,i=this.length;i>e;e++)this[e].apply(t,arguments)},dream.util.EventDispatcher.prototype.propagate=function(t,e){var i=e||this.name,n=Array.prototype.splice.call(arguments,2,arguments.length);return this.add(n.length?function(){for(var e,r=0;e=n[r];r++)arguments[r]=e.call(t,arguments[r]);arguments.length<n.length&&(arguments.length=n.length);var s;t.__events&&(s=t.__events[i])&&s.dispatch.apply(s,arguments)}:function(){var e;t.__events&&(e=t.__events[i])&&e.dispatch.apply(e,arguments)},t)},dream.util.EventDispatcher.prototype.propagateFlagged=function(t,e){return this.add(function(){t[e]=!0})},dream.util.AssetLibrary=function(){dream.util.AssetLibrary._superClass.call(this),this.loader=new dream.static.Loader}.inherits(dream.collection.List),dream.util.AssetLibrary.prototype.prepare=function(t){this.loader.isRequestSent&&this.loader.abort(),this.loader.resources=this.requiredResources,this.loader.load(t)},Object.defineProperty(dream.util.AssetLibrary.prototype,"requiredResources",{get:function(){for(var t,e=new dream.collection.Set,i=0;t=this[i];i++)e.addArray(t.requiredResources);return e}}),dream.util.RedrawRegionList=function(){}.inherits(Array),dream.util.RedrawRegionList.prototype.add=function(t){if(0>=t.width||0>=t.height)return!1;for(var e,i=0;e=this[i];i++)if(t.hasIntersectWith(e))return this.add(this.splice(i,1)[0].add(t));return this.push(t)},dream.util.RedrawRegionList.prototype.addArray=function(t){if(t instanceof dream.util.RedrawRegionList)for(var e,i=0;e=t[i];i++)this.push(e);else for(var e,i=0;e=t[i];i++)this.add(e)},dream.util.RedrawRegionList.prototype.clear=function(){this.splice(0,this.length)},dream.util.BufferCanvas=function(t,e){this.canvas=document.createElement("canvas"),this.canvas.width=t,this.canvas.height=e,this.context=this.canvas.getContext("2d")},dream.util.getRequestAnimationFrame=function(t){return t?function(e){return window.setTimeout(e,1e3/t)}:window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(t){return window.setTimeout(t,1e3/60)}},dream.util.getCancelRequestAnimationFrame=function(t){return t?window.clearTimeout:window.cancelRequestAnimationFrame||window.webkitCancelRequestAnimationFrame||window.mozCancelRequestAnimationFrame||window.oCancelRequestAnimationFrame||window.msCancelRequestAnimationFrame||window.clearTimeout},dream.util.assert=function(t,e){if(!t)throw Error("Assertion failed! "+(e||""))},dream.util.objCount=0,dream.util.getId=function(t){return t.__GID||(t.__GID=++dream.util.objCount)},dream.util.createProperty=function(t,e,i){var n=i||"_"+e;return Object.defineProperty(t,e,{get:Function("return this."+n),set:Function("v","this."+n+"=v;")})},dream.util.createEventProperty=function(t,e,i,n){var r=i||"onChange",s=n||"_"+e;return Object.defineProperty(t,e,{get:Function("return this."+s),set:Function("v","var o = this."+s+";this."+s+"=v;dream.event.dispatch(this, '"+r+"', o);")})},dream.util.createFlagProperty=function(t,e,i,n){var r=i||"isChanged",s=n||"_"+e;return Object.defineProperty(t,e,{get:Function("return this."+s),set:Function("v","var o = this."+s+";this."+s+"=v; if(v!=o) this."+r+" = true;")})},dream.util.createEventFlagProperty=function(t,e,i,n,r){var s=i||"onChange",o=n||"isChanged",a=r||"_"+e;return Object.defineProperty(t,e,{get:Function("return this."+a),set:Function("v","var o = this."+a+";this."+a+"=v;dream.event.dispatch(this, '"+s+"', o);if(v!=o) this."+o+" = true;")})},dream.util.profile=function(t,e){for(var i=e||100,n=0,r=0,s=0,o=0;i>o;o++){var a=performance.now();t();var h=performance.now()-a;0==o?n=r=s=h:(n+=h,r=r>h?h:r,s=h>s?h:s)}return{avg:n/i,min:r,max:s,samples:i,toString:function(){return this.avg+"x"+this.samples+" +"+this.max+" -"+this.min}}},dream.visual={},function(){var t=function(t,e,i,n,r,s,o){this.url=t,this.img=new dream.static.Resource(t),this.anchorX=void 0==s?0:s,this.anchorY=void 0==o?0:o,this.rect=new dream.Rect(e,i,n,r)},e=function(t){this.textures=new dream.collection.List,t&&this.textures.addJson(t)},i=e.prototype;i.getTextureArray=function(t){for(var e,i=[],n=t.length,r=0;e=this.textures[r];r++)e.name.substring(0,n)==t&&i.push(e);return i};var n=function(i,n){e.call(this);for(name in n)for(var r=n[name],s=void 0==r.col?1:r.col,o=0,a=0;s>a;a++)for(var h=0;r.count>h;h++,o++)this.textures.add(new t(i,r.left+h*r.width,r.top+a*r.height,r.width,r.height),name+"_"+o)}.inherits(e);dream.visual={Texture:t,SpriteSheet:e,SequentialSpriteSheet:n}}();